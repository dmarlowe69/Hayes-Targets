
Title: LOW LEVEL OPERATING SYSTEM
American Automation Cross-Assembler 1805 9.05.11
Assembly date: 11 Mar 1992
Assembly time:  8:32:16
Options in effect:expand format list object symbol errorfile uppercase 

Subtitle: (C)1984,85,86,87,88,89,90,91,92 HAYES INTERNATION CORPORATION
0004 T 0000                  T          SECTION TLX,$0000
0005                           ;****************************************************************************
0006                           ;
0007                           ;       LOW LEVEL OPERATING SYSTEM
0008                           ;
0009                           ;       FIRST PRODUCTION VERSION 1.0/07 JUL84
0010                           ;
0011                           ;       WRITTEN BY DENTON MARLOWE
0012                           ;
0013                           ;       COPYRIGHT HAYES INTERNATIONAL CORPORATION
0014                           ;
0015                           ;****************************************************************************
0016                           ;
0017                           ;                       REVISION DATE
0018                           ;
0019                           ;                       SEPTEMBER 14 1989
0020                           ;
0021                           ;                       PRODUCTION VERSION 1
0022                           ;
0023                           ; CHANGED PROPORTIONAL GAIN FROM 1 VOLT TO 2 VOLTS
0024                           ;
0025                           ;                       JANUARY 31 1989
0026                           ;
0027                           ;                       PRODUCTION VERSION 2
0028                           ;
0029                           ; THIS RELEASE REPLACES THE SOFTWARE INSTALLED IN THE PROTOTYPE TARGETS
0030                           ; REVISIONS ARE IN THE FIXED GAIN SETTINGS AND ARE NOTED
0031                           ;
0032                           ;                       JUNE 02 1991
0033                           ;
0034                           ;                       FLIGHT INTERNATIONAL TEST VERSION (VERSION 3)
0035                           ;
0036                           ; THIS RELEASE INCORPORATES EXTENSIVE MODIFICATION TO THE SOFTWARE. THE
0037                           ; TARGET CANNOT BE COMMAND INTO RECOVERY IF THE WINGS ARE ABOVE THE MINUS
0038                           ; 1.5 DEGREE POSITION. IF DONE SO, THE RECOVERY/FLY LIGHTS FLASH AND THE
0039                           ; TLX MUST BE COMMANDED BACK INTO FLY AND THEN BACK TO RECOVERY TO POSITION
0040                           ; THE WINGS AT THE -1.5 DEGREE POSITION. ALSO THE GAIN SETTING HARDCODED IN
0041                           ; THE AUTOPILOT USE THE VERSION 1 GAINS (25 FEET) UNTIL THE TLX PASSES
0042                           ; BELOW PRESET. ONCE BELOW PRESET ( AND WITH THE WINGS LESS THAN +/- 0.5 DEG
0043                           ; FROM THE MANUAL RESET POSITION, THE GAINS SWITCH TO THE VERSION 2 GAINS
0044                           ; (12.5 FEET). AT THIS TIME THE OK LIGHT BLINK RATE IS DOUBLED TO INDICATE
0045                           ; THE SWITCH. THE OK LIGHT RETURNS TO NORMAL APON A RECOVERY COMMAND.
0046                           ;
0047                           ; THE CHANGES WERE EXTENSIVE ENOUGH THAT A SECOND EPROM IS NOW REQUIRED IN
0048                           ; THE SYSTEM AT ADDRESS $0800.
0049                           ;
0050                           ;                       JUNE 16 1991
0051                           ;
0052                           ;                       PRODUCTION VERSION 4
0053                           ;
0054                           ; THIS RELEASE ADDS A FEW FEATURES TO THE FLIGHT INTERNATION VERSION
0055                           ; TEST FLOWN ON JUNE 13, 1991. A CHECK IS MADE BEFORE ENTERING "FLY' MODE
0056                           ; TO INSURE THAT FOUR CONSECUTIVE FLY COMMANDS ARE ISSUED. THIS IS TO PREVENT
0057                           ; AN COMMAND LINK GLITCH FROM COMMANDING THE TLX INTO FLY. ALSO, THE EXIT
0058                           ; FROM THE FLY MODE TO RECOVERY MODE, MADE BY THE DETECTION OF THE RECOVERY
0059                           ; COMMAND FROM THE CONTROL STATION IS PUT THROUGH A SECOND WAIT STATE TO
0060                           ; INSURE THE COMMAND IS VALID AND THAT A GLITCH IN THE COMMAND LINK WILL NOT
0061                           ; PLACE THE TLX INTO RECOVERY ONCE IN THE FLY MODE. ALSO, ONCE THE GAINS
0062                           ; ARE RESET BY THE TLX ENTERING "CAPTURE MODE", THE ALTITUDE DEVIATION IS
0063                           ; CHECK FOR THE TARGET GOING 50 FEET ABOVE PRESET. IF THIS OCCURS, THE GAINS
0064                           ; ARE SET BACK TO THE VERSION 1 VALUES (25 FEET) UNTILL SUCH TIME AS THE
0065                           ; TLX CAN ONCE AGAIN CATURE THE PRESET ALTITUDE. ONCE THE GAINS ARE SET BACK
0066                           ; TO THE VERSION 1 VALUES, THE OK LIGHT IS RESET TO ITS NORMAL BLINK RATE.
0067                           ;
0068                           ;                       FEB 27 1992
0069                           ;
0070                           ;                       PRODUCTION VERSION 5
0071                           ;
0072                           ; THIS RELEASE REMOVES THE BREAK OUT OF CAPTURE MODE OF VERSION 4. THIS
0073                           ; PROVED TO BE UNSTABLE IN ROUGH CONDITIONS. ALSO A FIX WAS MADE IN THE
0074                           ; CMDPAT AREA THAT RE-ENABLES MANUAL MODE (WHICH WAS LOST DUE TO A LOGIC
0075                           ; CONFLICT). ALSO ADDED IN ALTERNATE PROGRAM INTERFACE AT $0C00.
0076                           ;
0077                           ;****************************************************************************
0078                           ;
0079                           ;       EQUATES
0080                           ;
0081                           ;****************************************************************************
0082 T 0000                             ORG     $0000               ; EPROM NUMBER ONE
0083                           ;
0084        00004000           RAM      EQU     $4000               ; CPU CONFIGURATION
0085                           ;****************************************************************************
0086                           ;       VERSION DEFINTIONS
0087                           ;****************************************************************************
0088        00000000           VER_0    EQU     0                   ; PROTOTYPE CONFIGURATION
0089        00000001           VER_1    EQU     1                   ; STANDARD HAYES CONFIGURATION (SERIAL NO. 1-19)
0090        00000002           VER_2    EQU     2                   ; STANDARD HAYES CONFIGURATION (SERIAL NO. 20-?)
0091        00000003           VER_3    EQU     3                   ; SPECIAL FLIGHT INTERNATION VERSION (SERIAL NO. 12)
0092        00000004           VER_4    EQU     4                   ; STANDARD FLIGHT INTERNATION VERSION (BEFORE FEB 7,1992)
0093        00000005           VER_5    EQU     5                   ; STANDARD HAYES CONFIGURATION TO MATCH NEW ALTIMETER
0094                           
0095                           ;VERSION EQU    VER_0           ; SET VERSION
0096                           ;VERSION EQU    VER_1           ; SET VERSION
0097                           ;VERSION EQU    VER_2           ; SET VERSION
0098                           ;VERSION EQU    VER_3           ; SET VERSION
0099                           ;VERSION EQU    VER_4                   ; SET VERSION
0100        00000005           VERSION  EQU     VER_5               ; SET VERSION
0101                           
0102        00000000                    IF      (VERSION EQ VER_0)
0104                                    ENDIF   
0105                           
0106        00000000                    IF      (VERSION EQ VER_1)
0108                                    ENDIF   
0109                           
0110        00000000                    IF      (VERSION EQ VER_2)
0112                                    ENDIF   
0113                           
0114        00000000                    IF      (VERSION EQ VER_3)
0116                                    ENDIF   
0117                           
0118        00000000                    IF      (VERSION EQ VER_4)
0120                                    ENDIF   
0121                           
0122        00000001                    IF      (VERSION EQ VER_5)
0124                                    ENDIF   
0125                           
0126        00000001                    IF      (VERSION GT VER_2)
0128                                    ENDIF   
0129                           
0130                           ;****************************************************************************
0131                           ;       ACCEL CONTROLLER ADDRESS
0132                           ;****************************************************************************
0133                           ; TLXACC        EQU     $0400    ; (EPROM ONE)
0134                           ;****************************************************************************
0135                           ;       ALTERNATE CONTROLLER ADDRESS
0136                           ;****************************************************************************
0137                           ; TLXALT        EQU     $0800   ; (EPROM TWO)
0138                           ;****************************************************************************
0139                           ;
0140                           ;       DATA STACK EQUATES
0141                           ;
0142                           ;****************************************************************************
0143        000041FF           ATOP     EQU     RAM+$01FF           ; TOP OF ALT STACK
0144        000041E0           ABOT     EQU     RAM+$01E0           ; BOTTOM OF ALT STACK
0145        00000020           ABYTE    EQU     $0020               ; NUMBER BYTES
0146                           ;
0147        000042FF           CTOP     EQU     RAM+$02FF           ; TOP OF ACCEL STACK
0148        000042E0           CBOT     EQU     RAM+$02E0           ; BOTTOM OF ACCEL STACK
0149        00000020           CBYTE    EQU     $0020               ; NUMBER BYTES
0150        00000010           CBYTE2   EQU     $0010               ; NUMBER WORDS
0151                           ;
0152        000043FF           COUNT    EQU     RAM+$03FF           ; LOOP COUNTER
0153                           ;
0154        0000437F           ALTREL   EQU     RAM+$037F           ; RELIBILITY
0155        0000437D           RELFLG   EQU     RAM+$037D           ; REL FLAG
0156        0000437B           RELCNT   EQU     RAM+$037B           ; REL COUNTER
0157                           ;
0158        0000436F           ALTLOW   EQU     RAM+$036F           ; 100FT ALT
0159        0000435F           ALTHIH   EQU     RAM+$035F           ; 1000FT ALT
0160        0000434F           FEDPOT   EQU     RAM+$034F           ; FEEDBACK POT
0161        0000433F           GLOADS   EQU     RAM+$033F           ; ACCEL
0162                           ;
0163        0000443F           MATH     EQU     RAM+$043F           ; MATH STACK
0164        0000447F           INPUT    EQU     RAM+$047F           ; INPUT STACK
0165        000044FF           UTIL     EQU     RAM+$04FF           ; UTILLITY STACK
0166                           ;
0167        0000450F           PRESET   EQU     RAM+$050F           ; PRESET ALT
0168        0000450B           PRESE1   EQU     RAM+$050B           ; PRESET ONE
0169        00004507           PRESE2   EQU     RAM+$0507           ; PRESET TEN
0170        00004503           PRESE3   EQU     RAM+$0503           ; PRESET 100
0171                           ;
0172        00004517           EGAIN2   EQU     RAM+$0517           ; PROPORTIONAL GAIN TWO
0173        0000451F           EGAIN    EQU     RAM+$051F           ; PROPORTIONAL GAIN
0174        0000452F           RGAIN    EQU     RAM+$052F           ; DERIVATIVE GAIN
0175        0000453F           IGAIN    EQU     RAM+$053F           ; INTEGRAL GAIN
0176        0000454F           SGAIN    EQU     RAM+$054F           ; SCALE FACTOR
0177        0000455F           RESET    EQU     RAM+$055F           ; MANUAL RESET
0178                           ;****************************************************************************
0179                           ;       TEST REGISTERS
0180                           ;****************************************************************************
0181        0000463F           PREONE   EQU     RAM+$063F           ; ONE DIGIT
0182        0000463B           PRETEN   EQU     RAM+$063B           ; TEN DIGIT
0183        00004637           PREHUN   EQU     RAM+$0637           ; HUN DIGIT
0184                           ;****************************************************************************
0185                           ;       STATUS LIGHTS AND BITS EQUATES
0186                           ;****************************************************************************
0187        00000000           MANLIT   EQU     $0000               ; MANUAL CONTROL LIGHT
0188        00000010           RECLIT   EQU     $0010               ; RECOVERY LIGHT
0189        00000020           PRGLIT   EQU     $0020               ; PRG CONTROLLER LIGHT
0190        00000040           ALTLIT   EQU     $0040               ; ALT PROGRAM LIGHT
0191        00000060           ACCLIT   EQU     $0060               ; ACC CONTROLLER LIGHTS
0192                           ;****************************************************************************
0193        00000000           ACCBIT   EQU     $0000               ; ACC BITS
0194        00000001           RECBIT   EQU     $0001               ; RECOVERY BIT
0195        00000002           PRGBIT   EQU     $0002               ; PRG BIT
0196        00000004           ALTBIT   EQU     $0004               ; ALT BITS
0197        00000006           MANBIT   EQU     $0006               ; MANUAL BIT
0198                           ;****************************************************************************
0199                           ;       OK LIGHT COUNTER
0200                           ;****************************************************************************
0201        00000040           OKLITE   EQU     $40
0202                           ;****************************************************************************
0203                           ;       COMMAND WORD
0204                           ;****************************************************************************
0205        000046FF           COMWRD   EQU     RAM+$06FF           ; COMMAND WORD
0206        0000467F           TIMER    EQU     RAM+$067F           ; TIMER STACK
0207                           ;****************************************************************************
0208                           ;       GAIN SWITCH FLAGS
0209                           ;****************************************************************************
0210        000047FF           PFLAG    EQU     RAM+$07FF           ; PRESET FLAG
0211        0000477F           WFLAG    EQU     RAM+$077F           ; WING FLAG
0212                           ;****************************************************************************
0213                           ;       COMMAND WORD CHECKSUM
0214                           ;****************************************************************************
0215        0000473F           COMCHK   EQU     RAM+$073F           ; LAST COMMAND
0216        0000473D           COMCNT   EQU     RAM+$073D           ; COMMAND CHECK
0217        0000473B           COMFLG   EQU     RAM+$073B           ; COMMAND FLAG
0218                           ;****************************************************************************
0219                           ;
0220                           ;       POWER ON RESET ENTRY
0221                           ;
0222                           ;****************************************************************************
0223 T 0000 71                          DIS                         ; DISABLE INTERRUPTS
0224 T 0001 00                          DB      $00
0225                           ;****************************************************************************
0226                           ;       SET WINGS TO RECOVERY POSITION
0227                           ;****************************************************************************
0228 T 0002 61                          OUT     1                               ; I/O GROUP 30
0229 T 0003 30                          DB      $30
0230 T 0004 63                          OUT     3                               ; RECOVERY
0231 T 0005 BF                          DB      WNGREC
0232                           ;****************************************************************************
0233                           ;       TEST FOR ACTIVE DECODER
0234                           ;****************************************************************************
0235        00000001                    IF      (VERSION GT VER_2)
0236                           
0237 T 0006 C00A00                      LBR     RTD1                    ; BRANCH TO PATCH
0238                           
0240                                    ENDIF   
0241                           ;****************************************************************************
0242                           ;
0243                           ;       SETUP COUNTER MODE 2
0244                           ;
0245                           ;       1805 DOWN COUNTER WITH DOWN COUNT ON
0246                           ;       EACH TRANSITION OF EF2 (DATA VALID)
0247                           ;       THE INITIAL COUNTER VALUE IS SET TO
0248                           ;       UNDERFLOW EVERY 64 DEC COUNTS
0249                           ;       (0.25 SECONDS) AND TO FLIP/FLOP THE
0250                           ;       Q TOGGLE.
0251                           ;       THE COUNTER VALUE IS COMPUTED BY:
0252                           ;
0253                           ;       2048 BITS/SEC FROM REMTRON DECODER
0254                           ;       256 FRAMES/SEC FROM DECODER
0255                           ;       0.25 SEC / 256 SEC/FRAME = 64
0256                           ;
0257                           ;****************************************************************************
0258 T 0009 6800               OKSET:   STPC                        ; STOP COUNTER
0259 T 000B F840                        LDI     OKLITE                  ; 64 COUNTS
0260 T 000D 6806                        LDC                         ; LOAD COUNTER
0261 T 000F 6809                        ETQ                         ; ENABLE Q
0262 T 0011 6803                        SCM2                        ; COUNTER MODE 2
0263                           ;****************************************************************************
0264                           ;       SETUP PROGRAM COUNTER IN R3
0265                           ;****************************************************************************
0266 T 0013 68C30018           TMINIT:  RLDI    R3,TMWAIT
0267 T 0017 D3                          SEP     R3
0268                           ;****************************************************************************
0269                           ;
0270                           ;       COMMAND LINK SOFTWARE
0271                           ;
0272                           ;****************************************************************************
0273                           ;
0274                           ;       WAIT FOR RECOVERY/FLY SWITCH TO REC
0275                           ;       BLINK RECOVERY LIGHT DURING WAIT
0276                           ;
0277                           ;****************************************************************************
0278                           ;****************************************************************************
0279                           ;
0280                           ;       SETUP PIO PORTS FOR COMMAND/TM LINK
0281                           ;
0282                           ;       I/O GROUP NUMBER 8
0283                           ;       CHANNEL A INPUT (DATA WORD)
0284                           ;       CHANNEL B BIT PROGRAMABLE
0285                           ;       LOW NIBBLE INPUT (ADDRESS)
0286                           ;       HIGH NIBBLE OUTPUT (STATUS)
0287                           ;
0288                           ;****************************************************************************
0289 T 0018 E3                 TMWAIT:  SEX     R3                  ; SET PC TO SP
0290 T 0019 61                          OUT     1                               ; I/O GROUP 8
0291 T 001A 08                          DB      $08
0292 T 001B 62                          OUT     2
0293 T 001C 0F                          DB      $0F
0294 T 001D 62                          OUT     2
0295 T 001E F7                          DB      $F7
0296 T 001F 62                          OUT     2
0297 T 0020 F0                          DB      $F0
0298                           ;
0299 T 0021 68C2447F                    RLDI    R2,INPUT                ; INPUT STACK
0300 T 0025 E2                          SEX     R2                              ; SET SP
0301 T 0026 F810                        LDI     RECLIT                  ; RECOVERY LIGHT
0302 T 0028 AC                          PLO     RC                              ; STORE WORD
0303                           ;****************************************************************************
0304 T 0029 3529               VAL:     B2      VAL                 ; WAIT FOR DATA VALID
0305                           ;****************************************************************************
0306 T 002B 6E                          INP     6                               ; INPUT ADDRESS
0307 T 002C 60                          IRX                         ; INCREMENT SP
0308 T 002D 6C                          INP     4                               ; INPUT ADDRESS
0309 T 002E 22                          DEC     R2                              ; RESET SP
0310 T 002F F0                          LDX                         ; GET ADDRESS
0311 T 0030 FA0F                        ANI     $0F                     ; MASK BITS
0312                           ;
0313 T 0032 FF09                        SMI     $09                     ; CHANNEL NINE
0314 T 0034 3A29                        BNZ     VAL                     ; IF NOT NEXT INPUT
0315                           ;****************************************************************************
0316                           ;       CHECK REC/FLY BIT FOR REC
0317                           ;****************************************************************************
0318 T 0036 60                          IRX                         ; INCREMENT TO DATA
0319 T 0037 F0                          LDX                         ; GET DATA
0320 T 0038 BC                          PHI     RC                              ; STORE WORD
0321 T 0039 22                          DEC     R2                              ; RESET SP
0322                           ;
0323 T 003A 8C                          GLO     RC                              ; GET LIGHT
0324 T 003B 52                          STR     R2                              ; STACK IT
0325 T 003C FBFF                        XRI     $FF                     ; INVERT BITS
0326 T 003E FA10                        ANI     RECLIT                  ; ONLY REC LIGHT
0327 T 0040 AC                          PLO     RC                              ; RESET LIGHT
0328 T 0041 66                          OUT     6                               ; SEND STATUS
0329 T 0042 22                          DEC     R2                              ; RESET STACK
0330                           ;
0331 T 0043 68CF3FFF                    RLDI    RF,$3FFF                ; COUNTER DELAY
0332 T 0047 C4                 DELAY1:  NOP                         ; NO OPERATION
0333 T 0048 682F0047                    DBNZ    RF,DELAY1               ; DELAY LOOP
0334                           ;
0335 T 004C 9C                          GHI     RC                              ; GET WORD
0336 T 004D FA01                        ANI     RECBIT                  ; MASK REC BIT
0337 T 004F 3229                        BZ      VAL                     ; IF NOT REC, WAIT
0338                           ;****************************************************************************
0339                           ;
0340                           ;       COMMAND LINK GRABER ROUTINE
0341                           ;
0342                           ;****************************************************************************
0343 T 0051 E3                 GRABER:  SEX     R3                  ; SET PC TO SP
0344 T 0052 61                          OUT     1                               ; I/O GROUP 8
0345 T 0053 08                          DB      $08
0346 T 0054 68C2447F                    RLDI    R2,INPUT                ; INPUT STACK
0347 T 0058 E2                          SEX     R2                              ; SET SP
0348                           ;****************************************************************************
0349                           ;       INITIALIZE CHANNEL NUMBER TO ONE
0350                           ;****************************************************************************
0351 T 0059 68C70001                    RLDI    R7,$0001
0352                           ;****************************************************************************
0353                           ;       WAIT ON DATA VALID
0354                           ;****************************************************************************
0355 T 005D 355D               VALID:   B2      VALID
0356                           ;****************************************************************************
0357                           ;       INPUT BYTES FROM 1851 INPUT PORTS
0358                           ;****************************************************************************
0359 T 005F 6E                          INP     6                               ; INPUT ADDRESS
0360 T 0060 60                          IRX                         ; INCREMENT SP
0361 T 0061 6C                          INP     4                               ; INPUT DATA
0362 T 0062 22                          DEC     R2                              ; RESET SP
0363 T 0063 F0                          LDX                         ; GET ADDRESS
0364 T 0064 FA0F                        ANI     $0F                     ; MASK BITS
0365 T 0066 52                          STR     R2                              ; REPLACE ON STACK
0366                           ;****************************************************************************
0367                           ;       CHECK FOR CORRECT ADDRESS
0368                           ;****************************************************************************
0369 T 0067 87                          GLO     R7                              ; GET CHANNEL
0370 T 0068 F7                          SM                          ; COMPARE INPUT
0371 T 0069 3A5D                        BNZ     VALID                   ; IF NOT SAME, NEXT
0372                           ;****************************************************************************
0373                           ;       RETREIVE DATA
0374                           ;****************************************************************************
0375 T 006B 60                          IRX                         ; INCREMENT TO DATA
0376 T 006C F0                          LDX                         ; GET DATA
0377 T 006D 22                          DEC     R2                              ; RESET SP
0378 T 006E 52                          STR     R2                              ; REPLACE ON STACK
0379                           ;****************************************************************************
0380                           ;       DETERMINE DATA CHANNEL
0381                           ;****************************************************************************
0382 T 006F 87                 WHICH:   GLO     R7                  ; GET CHANNEL
0383 T 0070 17                          INC     R7                              ; INC FOR NEXT
0384                           ;
0385 T 0071 FF01                        SMI     $01
0386 T 0073 329B                        BZ      CH1
0387                           ;
0388 T 0075 FF01                        SMI     $01
0389 T 0077 32A1                        BZ      CH2
0390                           ;
0391 T 0079 FF01                        SMI     $01
0392 T 007B 32A7                        BZ      CH3
0393                           ;
0394 T 007D FF01                        SMI     $01
0395 T 007F 32AD                        BZ      CH4
0396                           ;
0397 T 0081 FF01                        SMI     $01
0398 T 0083 32B3                        BZ      CH5
0399                           ;
0400 T 0085 FF01                        SMI     $01
0401 T 0087 32B9                        BZ      CH6
0402                           ;
0403 T 0089 FF01                        SMI     $01
0404 T 008B 32BF                        BZ      CH7
0405                           ;
0406 T 008D FF01                        SMI     $01
0407 T 008F 32C5                        BZ      CH8
0408                           ;
0409 T 0091 30CB                        BR      CH9
0410                           ;****************************************************************************
0411                           ;
0412                           ;       LOAD DATA AND STORE IN M(RD)
0413                           ;       AND STORE ZERO IN HIGH BYTE M(RD)-1
0414                           ;
0415                           ;****************************************************************************
0416 T 0093 F0                 CH0:     LDX                         ; GET DATA
0417 T 0094 5D                          STR     RD                              ; STACK IT
0418                           ;
0419 T 0095 2D                          DEC     RD                              ; DECREMENT TO HIGH BYTE
0420 T 0096 F800                        LDI     $00                     ; ZERO BYTE
0421 T 0098 5D                          STR     RD                              ; STACK IT
0422                           ;
0423 T 0099 305D                        BR      VALID                   ; NEXT CHANNEL
0424                           ;****************************************************************************
0425                           ;       CHANNEL ONE (PRESET ONE'S)
0426                           ;****************************************************************************
0427 T 009B 68CD450B           CH1:     RLDI    RD,PRESE1
0428 T 009F 3093                        BR      CH0
0429                           ;****************************************************************************
0430                           ;       CHANNEL TWO (PRESET TEN'S)
0431                           ;****************************************************************************
0432 T 00A1 68CD4507           CH2:     RLDI    RD,PRESE2
0433 T 00A5 3093                        BR      CH0
0434                           ;****************************************************************************
0435                           ;       CHANNEL THREE (PRESET 100'S)
0436                           ;****************************************************************************
0437 T 00A7 68CD4503           CH3:     RLDI    RD,PRESE3
0438 T 00AB 3093                        BR      CH0
0439                           ;****************************************************************************
0440                           ;       CHANNEL FOUR (PROPORTIONAL GAIN)
0441                           ;****************************************************************************
0442 T 00AD 68CD451F           CH4:     RLDI    RD,EGAIN
0443 T 00B1 3093                        BR      CH0
0444                           ;****************************************************************************
0445                           ;       CHANNEL FIVE (HEIGHT RATE GAIN)
0446                           ;****************************************************************************
0447 T 00B3 68CD452F           CH5:     RLDI    RD,RGAIN
0448 T 00B7 3093                        BR      CH0
0449                           ;****************************************************************************
0450                           ;       CHANNEL SIX (ACCEL INTEGRAL GAIN)
0451                           ;****************************************************************************
0452 T 00B9 68CD453F           CH6:     RLDI    RD,IGAIN
0453 T 00BD 3093                        BR      CH0
0454                           ;****************************************************************************
0455                           ;       CHANNEL SEVEN (OUTPUT SCALE FACTOR)
0456                           ;****************************************************************************
0457 T 00BF 68CD454F           CH7:     RLDI    RD,SGAIN
0458 T 00C3 3093                        BR      CH0
0459                           ;****************************************************************************
0460                           ;       CHANNEL EIGHT (MANUAL RESET)
0461                           ;****************************************************************************
0462 T 00C5 68CD455F           CH8:     RLDI    RD,RESET
0463 T 00C9 3093                        BR      CH0
0464                           ;****************************************************************************
0465                           ;
0466                           ;       CHANNEL NINE: COMMAND
0467                           ;
0468                           ;****************************************************************************
0469 T 00CB 68CC46FF           CH9:     RLDI    RC,COMWRD           ; COMMAND WORD
0470 T 00CF F0                          LDX                         ; GET DATA
0471 T 00D0 5C                          STR     RC                              ; STASH WORD
0472                           ;
0473 T 00D1 BC                          PHI     RC                              ; STORE
0474                           ;****************************************************************************
0475                           ;       JUMP TO PATCH AREA
0476                           ;****************************************************************************
0477        00000001                    IF      (VERSION GT VER_3)
0478                           
0479 T 00D2 C00A1B                      LBR     CMDPAT                  ; JUMP TO PATCH AREA
0480                           
0482                                    ENDIF   
0483                           ;****************************************************************************
0484                           ;       ECHO COMMAND WORD TO STATUS LIGHTS
0485                           ;****************************************************************************
0486 T 00D5 68C244FF           ECHO:    RLDI    R2,UTIL             ; UTIL STACK
0487 T 00D9 E2                          SEX     R2                              ; SET SP
0488 T 00DA 9C                          GHI     RC                              ; GET COMMAND
0489                           ;
0490 T 00DB FE                          SHL                         ; LEFT JUSTIFY
0491 T 00DC FE                          SHL                         ;
0492 T 00DD FE                          SHL                         ;
0493 T 00DE FE                          SHL                         ;
0494                           ;
0495 T 00DF 52                          STR     R2                              ; STACK IT
0496 T 00E0 66                          OUT     6                               ; OUTPUT
0497 T 00E1 22                          DEC     R2                              ; RESET STACK
0498                           ;****************************************************************************
0499                           ;
0500                           ;       EXECUTE COMMAND INSTRUCTIONS
0501                           ;               BIT 0 REC/FLY (1=REC/0=FLY)
0502                           ;               BIT 1 PRG1
0503                           ;               BIT 2 PRG2
0504                           ;               BIT 3 FIRE ONE
0505                           ;
0506                           ;       WHEN BIT 0 = 1 (FLY)
0507                           ;
0508                           ;               PRG1=0,PRG2=0 ACCEL CONTROLLER
0509                           ;               PRG1=1,PRG2=0 PROGRAMABLE CONTROLLER
0510                           ;               PRG1=0,PRG2=1 ALTERNATE CONTROL MODE
0511                           ;               PRG1=1,PRG2=1 MANUAL CONTROL MODE
0512                           ;
0513                           ;****************************************************************************
0514 T 00E2 9C                          GHI     RC                              ; GET COMMAND
0515 T 00E3 FA01                        ANI     RECBIT                  ; RECOVERY BIT
0516 T 00E5 CA0106                      LBNZ    PULLIT                  ; RECOVERY MODE
0517                           ;
0518 T 00E8 9C                          GHI     RC                              ; GET COMMAND
0519 T 00E9 FA07                        ANI     $07                     ; MASK BIT 3
0520 T 00EB C20130                      LBZ     ACC                     ; ACCEL CONTROLLER
0521                           ;
0522 T 00EE 9C                          GHI     RC                              ; GET COMMAND
0523 T 00EF FA07                        ANI     $07                     ; MASK BIT 3
0524 T 00F1 FF02                        SMI     PRGBIT                  ; PRG BIT
0525 T 00F3 C2018B                      LBZ     PRG                     ; PROGRAM MODE
0526                           ;
0527 T 00F6 9C                          GHI     RC                              ; GET COMMAND
0528 T 00F7 FA07                        ANI     $07                     ; MASK BIT 3
0529 T 00F9 FF04                        SMI     ALTBIT                  ; ALTERNATE BIT
0530 T 00FB C201B3                      LBZ     ALT                     ; ALTERNATE MODE
0531                           ;
0532 T 00FE 9C                          GHI     RC                              ; GET COMMAND
0533 T 00FF FA07                        ANI     $07                     ; MASK BIT 3
0534 T 0101 FF06                        SMI     MANBIT                  ; MANUAL BIT
0535 T 0103 C2010F                      LBZ     MANUAL                  ; MANUAL MODE
0536                           ;****************************************************************************
0537                           ;
0538                           ;       RECOVERY MODE
0539                           ;
0540                           ;****************************************************************************
0541 T 0106 E3                 PULLIT:  SEX     R3                  ; SET R3 TO SP
0542 T 0107 61                          OUT     1                               ; I/O GROUP
0543 T 0108 30                          DB      $30
0544 T 0109 63                          OUT     3                               ; WINGS AT -1.5 DEG
0545 T 010A BF                          DB      WNGREC
0546 T 010B E2                          SEX     R2                              ; RESET SP
0547                           ;
0548 T 010C C001EA                      LBR     DETDEC
0549                           ;****************************************************************************
0550                           ;
0551                           ;       MANUAL WING CONTROL
0552                           ;
0553                           ;****************************************************************************
0554 T 010F E3                 MANUAL:  SEX     R3                  ; SET R3 TO SP
0555 T 0110 61                          OUT     1                               ; I/O GROUP
0556 T 0111 30                          DB      $30
0557 T 0112 E2                          SEX     R2                              ; RESET SP
0558                           ;
0559 T 0113 68CD455F                    RLDI    RD,RESET                ; POINT TO WING
0560 T 0117 0D                          LDN     RD                              ; GET WING
0561 T 0118 A1                          PLO     R1                              ; STASH
0562                           ;****************************************************************************
0563                           ;       SOFTWARE LIMIT SWITCHES
0564                           ;****************************************************************************
0565 T 0119 81                          GLO     R1                              ; GET COMMAND
0566 T 011A FF19                        SMI     WNGNEG                  ; - LIMIT
0567 T 011C 3B28                        BNF     STOPC                   ; IF DF=1 OK
0568 T 011E 81                          GLO     R1                              ; GET COMMAND
0569 T 011F FFE5                        SMI     WNGPOS                  ; + LIMIT
0570 T 0121 3325                        BDF     LIMITC                  ; IF DF=1 LIMIT
0571                           ;
0572 T 0123 81                          GLO     R1                              ; GET COMMAND
0573                           ;
0574 T 0124 C8                          LSKP                        ; SKIP NEXT
0575                           ;
0576 T 0125 F8E5               LIMITC:  LDI     WNGPOS              ; MAXIMUM + LIMIT
0577                           ;
0578 T 0127 C8                          LSKP                        ; SKIP NEXT
0579                           ;
0580 T 0128 F819               STOPC:   LDI     WNGNEG              ; MAXIMUM - LIMIT
0581                           ;****************************************************************************
0582                           ;       OUTPUT TO SERVO
0583                           ;****************************************************************************
0584 T 012A 52                 SERVOC:  STR     R2                  ; STACK IT
0585 T 012B 63                          OUT     3                               ; OUT D/A CH 1
0586 T 012C 22                          DEC     R2                              ; RESET STACK
0587                           ;
0588 T 012D C001EA                      LBR     DETDEC
0589                           ;****************************************************************************
0590                           ;
0591                           ;       ACCEL CONTROLLER MODE
0592                           ;
0593                           ;****************************************************************************
0594 T 0130 68CE0004           ACC:     RLDI    RE,$0004            ; 4 BLINKS
0595 T 0134 F860                        LDI     ACCLIT                  ; ACC LIGHT
0596 T 0136 AC                          PLO     RC                              ; STORE
0597                           ;
0598 T 0137 8C                 ACCBNK:  GLO     RC                  ; GET LIGHT
0599 T 0138 52                          STR     R2                              ; STACK IT
0600 T 0139 FBFF                        XRI     $FF                     ; INVERT BITS
0601 T 013B FA60                        ANI     ACCLIT                  ; MASK BITS
0602 T 013D AC                          PLO     RC                              ; RESET LIGHT
0603 T 013E 66                          OUT     6                               ; SEND STATUS
0604 T 013F 22                          DEC     R2                              ; RESET STACK
0605                           ;
0606 T 0140 68CF1FFF                    RLDI    RF,$1FFF                ; COUNTER DELAY
0607 T 0144 C4                 DELAY2:  NOP                         ; NO OPERATION
0608 T 0145 682F0144                    DBNZ    RF,DELAY2               ; DELAY LOOP
0609 T 0149 682E0137                    DBNZ    RE,ACCBNK                  ; BLINK
0610                           ;
0611 T 014D 9C                          GHI     RC                              ; COMMAND
0612 T 014E FE                          SHL     
0613 T 014F FE                          SHL     
0614 T 0150 FE                          SHL     
0615 T 0151 FE                          SHL     
0616 T 0152 52                          STR     R2
0617 T 0153 66                          OUT     6
0618 T 0154 22                          DEC     R2
0619                           ;****************************************************************************
0620                           ;
0621                           ;       SET FIXED GAINS
0622                           ;
0623                           ;****************************************************************************
0624 T 0155 ED                 GAINER:  SEX     RD                  ; SET SP TO RD
0625                           ;
0626 T 0156 68CD451F                    RLDI    RD,EGAIN
0627                           
0628        00000000                    IF      (VERSION EQ VER_1)
0633                                    ELSE    
0634                           
0635 T 015A F866                        LDI     $66                     ; 2.000 VOLTS
0636                           
0638                                    ENDIF   
0639                           
0640 T 015C 73                          STXD    
0641 T 015D F800                        LDI     $00
0642 T 015F 5D                          STR     RD
0643                           ;
0644 T 0160 68CD452F                    RLDI    RD,RGAIN
0645 T 0164 F84C                        LDI     $4C                     ; 1.500 VOLTS
0646 T 0166 73                          STXD    
0647 T 0167 F800                        LDI     $00
0648 T 0169 5D                          STR     RD
0649                           ;
0650 T 016A 68CD453F                    RLDI    RD,IGAIN
0651 T 016E F833                        LDI     $33                     ; 1.000 VOLTS
0652 T 0170 73                          STXD    
0653 T 0171 F800                        LDI     $00
0654 T 0173 5D                          STR     RD
0655                           ;
0656 T 0174 68CD454F                    RLDI    RD,SGAIN
0657 T 0178 F850                        LDI     $50                     ; 1.568 VOLTS
0658 T 017A 73                          STXD    
0659 T 017B F800                        LDI     $00
0660 T 017D 5D                          STR     RD
0661                           ;
0662 T 017E 68CD455F                    RLDI    RD,RESET
0663 T 0182 F866                        LDI     $66                     ; 2.00 VOLTS
0664 T 0184 73                          STXD    
0665 T 0185 F800                        LDI     $00
0666 T 0187 5D                          STR     RD
0667                           ;****************************************************************************
0668                           ;       SET VERSION 1 GAINS
0669                           ;****************************************************************************
0670        00000000                    IF      ((VERSION GT VER_2) AND (VERSION LT VER_5))
0676                                    ENDIF   
0677                           ;****************************************************************************
0678 T 0188 C00400             ACCOK:   LBR     TLXACC              ; RUN CONTROLLER
0679                           ;****************************************************************************
0680                           ;
0681                           ;       PROGRAMABLE CONTROLLER MODE
0682                           ;
0683                           ;****************************************************************************
0684 T 018B 68CE0004           PRG:     RLDI    RE,$0004            ; 4 BLINKS
0685 T 018F F820                        LDI     PRGLIT                  ; PRG LIGHT
0686 T 0191 AC                          PLO     RC                              ; STORE
0687                           ;
0688 T 0192 8C                 PRGBNK:  GLO     RC                  ; GET LIGHT
0689 T 0193 52                          STR     R2                              ; STACK IT
0690 T 0194 FBFF                        XRI     $FF                     ; INVERT BITS
0691 T 0196 FA20                        ANI     PRGLIT                  ; MASK BITS
0692 T 0198 AC                          PLO     RC                              ; RESET LIGHT
0693 T 0199 66                          OUT     6                               ; SEND STATUS
0694 T 019A 22                          DEC     R2                              ; RESET STACK
0695                           ;
0696 T 019B 68CF1FFF                    RLDI    RF,$1FFF                ; COUNTER DELAY
0697 T 019F C4                 DELAY3:  NOP                         ; NO OPERATION
0698 T 01A0 682F019F                    DBNZ    RF,DELAY3               ; DELAY LOOP
0699 T 01A4 682E0192                    DBNZ    RE,PRGBNK               ; BLINK
0700                           ;
0701 T 01A8 9C                          GHI     RC                              ; COMMAND
0702 T 01A9 FE                          SHL     
0703 T 01AA FE                          SHL     
0704 T 01AB FE                          SHL     
0705 T 01AC FE                          SHL     
0706 T 01AD 52                          STR     R2
0707 T 01AE 66                          OUT     6
0708 T 01AF 22                          DEC     R2
0709                           ;
0710        00000001                    IF      (VERSION GT VER_2)
0711                           
0712 T 01B0 C009B6             PRGOK:   LBR     PRGPAT                  ; RUN CONTROLLER
0713                           
0715                           
0720                                    ENDIF   
0721                           ;****************************************************************************
0722                           ;
0723                           ;       ALTERNATE CONTROLLER MODE
0724                           ;
0725                           ;****************************************************************************
0726 T 01B3 68CE0004           ALT:     RLDI    RE,$0004            ; 4 BLINKS
0727 T 01B7 F840                        LDI     ALTLIT                  ; ALT LIGHT
0728 T 01B9 AC                          PLO     RC                              ; STORE
0729                           ;
0730 T 01BA 8C                 ALTBNK:  GLO     RC                  ; GET LIGHT
0731 T 01BB 52                          STR     R2                              ; STACK IT
0732 T 01BC FBFF                        XRI     $FF                     ; INVERT BITS
0733 T 01BE FA40                        ANI     ALTLIT                  ; MASK BITS
0734 T 01C0 AC                          PLO     RC                              ; RESET LIGHT
0735 T 01C1 66                          OUT     6                               ; SEND STATUS
0736 T 01C2 22                          DEC     R2                              ; RESET STACK
0737                           ;
0738 T 01C3 68CF1FFF                    RLDI    RF,$1FFF                ; COUNTER DELAY
0739 T 01C7 C4                 DELAY4:  NOP                         ; NO OPERATION
0740 T 01C8 682F01C7                    DBNZ    RF,DELAY4               ; DELAY LOOP
0741 T 01CC 682E01BA                    DBNZ    RE,ALTBNK               ; BLINK
0742                           ;
0743 T 01D0 9C                          GHI     RC                  ;COMMAND
0744 T 01D1 FE                          SHL     
0745 T 01D2 FE                          SHL     
0746 T 01D3 FE                          SHL     
0747 T 01D4 FE                          SHL     
0748 T 01D5 52                          STR     R2
0749 T 01D6 66                          OUT     6
0750 T 01D7 22                          DEC     R2
0751                           ;
0752 T 01D8 68CD0800                    RLDI    RD,TLXALT
0753 T 01DC 0D                          LDN     RD
0754 T 01DD FFC4                        SMI     $C4                     ; NOP
0755 T 01DF 32E7                        BZ      ALTOK
0756                           ;
0757 T 01E1 68C00000                    RLDI    R0,$0000
0758 T 01E5 E0                          SEX     R0
0759 T 01E6 D0                          SEP     R0
0760                           ;
0761 T 01E7 C00800             ALTOK:   LBR     TLXALT              ; RUN CONTROLLER
0762                           ;****************************************************************************
0763                           ;
0764                           ;       DETERMINE ALT DEVIATION
0765                           ;
0766                           ;****************************************************************************
0767 T 01EA 68CD44FF           DETDEC:  RLDI    RD,UTIL
0768                           ;****************************************************************************
0769                           ;
0770                           ;       THUMB WHEEL PRESET DECODE
0771                           ;
0772                           ;               PRESET=( (ONES/27) + (TENS/27)*10 +
0773                           ;                 (HUNDS/27)*100 )*255/100
0774                           ;
0775                           ;       THE GROUND STATION TRANSMITS THE
0776                           ;       PRESET ALTITUDE USING THUMB WHEEL
0777                           ;       SWITCHES. AS WIRED, THE DIGITS ARE
0778                           ;       INVERTED (9=0VOLTS,0=5VOLTS). IF
0779                           ;       THIS IS CHANGED, THE XRI INSTRUCTION
0780                           ;       IN THE CODE SHOULD BE COMMENTED OUT
0781                           ;       AND THE CORRESPONDING NOP SHOULD
0782                           ;       BE UN-COMMENTED.
0783                           ;
0784                           ;****************************************************************************
0785 T 01EE ED                          SEX     RD                              ; MATH STACK
0786 T 01EF F81B                        LDI     $1B                     ; LOW BYTE OF 27
0787 T 01F1 73                          STXD                        ; STACK IT
0788 T 01F2 F800                        LDI     $00                     ; HIGH BYTE OF 27
0789 T 01F4 5D                          STR     RD                              ; STACK IT
0790 T 01F5 68C70000                    RLDI    R7,$0000
0791 T 01F9 68C80000                    RLDI    R8,$0000
0792 T 01FD 68C90000                    RLDI    R9,$0000
0793                           ;
0794 T 0201 68C4463F                    RLDI    R4,PREONE
0795 T 0205 68C5463B                    RLDI    R5,PRETEN
0796 T 0209 68C14637                    RLDI    R1,PREHUN
0797                           ;****************************************************************************
0798 T 020D 68CB450B           ONES:    RLDI    RB,PRESE1
0799 T 0211 0B                          LDN     RB
0800                           ;       NOP
0801                           ;       NOP
0802 T 0212 FBFF                        XRI     $FF
0803 T 0214 C20227                      LBZ     TENS
0804 T 0217 AF                          PLO     RF
0805 T 0218 F800                        LDI     $00
0806 T 021A BF                          PHI     RF
0807 T 021B AE                          PLO     RE
0808 T 021C BE                          PHI     RE
0809                           ;
0810 T 021D 68C60791                    RLDI    R6,DIVQ
0811 T 0221 D6                          SEP     R6
0812                           ;
0813 T 0222 9F                          GHI     RF
0814 T 0223 B7                          PHI     R7
0815 T 0224 8F                          GLO     RF
0816 T 0225 A7                          PLO     R7
0817                           ;
0818 T 0226 54                          STR     R4
0819                           ;****************************************************************************
0820 T 0227 68CD44FE           TENS:    RLDI    RD,UTIL-1
0821 T 022B 68CB4507                    RLDI    RB,PRESE2
0822 T 022F 0B                          LDN     RB
0823                           ;               NOP
0824                           ;       NOP
0825 T 0230 FBFF                        XRI     $FF
0826 T 0232 C20255                      LBZ     HUNDS
0827 T 0235 AF                          PLO     RF
0828 T 0236 F800                        LDI     $00
0829 T 0238 BF                          PHI     RF
0830 T 0239 AE                          PLO     RE
0831 T 023A BE                          PHI     RE
0832                           ;
0833 T 023B 68C60791                    RLDI    R6,DIVQ
0834 T 023F D6                          SEP     R6
0835                           ;
0836 T 0240 8F                          GLO     RF
0837 T 0241 55                          STR     R5
0838                           ;
0839 T 0242 68CD443F                    RLDI    RD,MATH
0840 T 0246 F80A                        LDI     $0A
0841 T 0248 73                          STXD    
0842 T 0249 F800                        LDI     $00
0843 T 024B 5D                          STR     RD
0844                           ;
0845 T 024C 68C6074A                    RLDI    R6,MULT
0846 T 0250 D6                          SEP     R6
0847                           ;
0848 T 0251 9F                          GHI     RF
0849 T 0252 B8                          PHI     R8
0850 T 0253 8F                          GLO     RF
0851 T 0254 A8                          PLO     R8
0852                           ;****************************************************************************
0853 T 0255 68CD44FE           HUNDS:   RLDI    RD,UTIL-1
0854 T 0259 68CB4503                    RLDI    RB,PRESE3
0855 T 025D 0B                          LDN     RB
0856                           ;       NOP
0857                           ;       NOP
0858 T 025E FBFF                        XRI     $FF
0859 T 0260 3282                        BZ      SUMUP
0860 T 0262 AF                          PLO     RF
0861 T 0263 F800                        LDI     $00
0862 T 0265 BF                          PHI     RF
0863 T 0266 AE                          PLO     RE
0864 T 0267 BE                          PHI     RE
0865                           ;
0866 T 0268 68C60791                    RLDI    R6,DIVQ
0867 T 026C D6                          SEP     R6
0868                           ;
0869 T 026D 8F                          GLO     RF
0870 T 026E 51                          STR     R1
0871                           ;
0872 T 026F 68CD443F                    RLDI    RD,MATH
0873 T 0273 F864                        LDI     $64
0874 T 0275 73                          STXD    
0875 T 0276 F800                        LDI     $00
0876 T 0278 5D                          STR     RD
0877                           ;
0878 T 0279 68C6074A                    RLDI    R6,MULT
0879 T 027D D6                          SEP     R6
0880                           ;
0881 T 027E 9F                          GHI     RF
0882 T 027F B9                          PHI     R9
0883 T 0280 8F                          GLO     RF
0884 T 0281 A9                          PLO     R9
0885                           ;****************************************************************************
0886                           ;       SUM UP DIGITS
0887                           ;****************************************************************************
0888 T 0282 68CD44FF           SUMUP:   RLDI    RD,UTIL
0889 T 0286 F800                        LDI     $00
0890 T 0288 73                          STXD    
0891 T 0289 5D                          STR     RD
0892 T 028A 1D                          INC     RD
0893                           ;
0894 T 028B 87                          GLO     R7
0895 T 028C F4                          ADD     
0896 T 028D 73                          STXD    
0897 T 028E 97                          GHI     R7
0898 T 028F 74                          ADC     
0899 T 0290 5D                          STR     RD
0900 T 0291 1D                          INC     RD
0901                           ;
0902 T 0292 88                          GLO     R8
0903 T 0293 F4                          ADD     
0904 T 0294 73                          STXD    
0905 T 0295 98                          GHI     R8
0906 T 0296 74                          ADC     
0907 T 0297 5D                          STR     RD
0908 T 0298 1D                          INC     RD
0909                           ;
0910 T 0299 89                          GLO     R9
0911 T 029A F4                          ADD     
0912 T 029B 73                          STXD    
0913 T 029C 99                          GHI     R9
0914 T 029D 74                          ADC     
0915 T 029E 5D                          STR     RD
0916 T 029F 1D                          INC     RD
0917                           ;****************************************************************************
0918                           ;       MULT SUM BY 255 BITS
0919                           ;****************************************************************************
0920 T 02A0 68CD44FE                    RLDI    RD,UTIL-1
0921 T 02A4 F8FF                        LDI     $FF
0922 T 02A6 AF                          PLO     RF
0923 T 02A7 F800                        LDI     $00
0924 T 02A9 BF                          PHI     RF
0925 T 02AA 68C6074A                    RLDI    R6,MULT
0926 T 02AE D6                          SEP     R6
0927                           ;****************************************************************************
0928                           ;       DIVIDE BY 100 BITS
0929                           ;****************************************************************************
0930 T 02AF 68CD44FF                    RLDI    RD,UTIL
0931 T 02B3 F864                        LDI     $64
0932 T 02B5 73                          STXD    
0933 T 02B6 F800                        LDI     $00
0934 T 02B8 5D                          STR     RD
0935 T 02B9 68C60791                    RLDI    R6,DIVQ
0936 T 02BD D6                          SEP     R6
0937                           ;****************************************************************************
0938                           ;       CHECK FOR MINIMUM PRESET OF 20 FT
0939                           ;****************************************************************************
0940 T 02BE 9F                          GHI     RF                              ; HIGH BYTE
0941 T 02BF 3ACA                        BNZ     PREOK                   ; IF NON-ZERO OK
0942 T 02C1 8F                          GLO     RF                              ; LOW BYTE
0943 T 02C2 FF33                        SMI     $33                     ; 20 FT
0944 T 02C4 33CA                        BDF     PREOK                   ; DF=1 OK
0945 T 02C6 68CF0033                    RLDI    RF,$0033                ; PRESET=20 FT
0946                           ;****************************************************************************
0947                           ;       PUT PRESET ON STACK
0948                           ;****************************************************************************
0949 T 02CA 68CD450F           PREOK:   RLDI    RD,PRESET
0950 T 02CE 8F                          GLO     RF
0951 T 02CF 73                          STXD    
0952 T 02D0 9F                          GHI     RF
0953 T 02D1 5D                          STR     RD
0954                           ;****************************************************************************
0955                           ;       SHIFT ALT STACK DOWN ONE ENTRY
0956                           ;****************************************************************************
0957 T 02D2 68CA41E2           ALTSFC:  RLDI    RA,ABOT+$02         ; BOTTOM OF STACK+2
0958 T 02D6 68CB41E0                    RLDI    RB,ABOT                 ; BOTTOM STACK
0959 T 02DA 68CC001E                    RLDI    RC,ABYTE-$02        ; NUMBER BYTES-2
0960 T 02DE EA                          SEX     RA                              ; RA IS SP
0961                           ;
0962 T 02DF 72                 ASHFTC:  LDXA                        ; GET BYTE
0963 T 02E0 5B                          STR     RB                              ; MOVE DOWN
0964 T 02E1 1B                          INC     RB                              ; INCREMENT POINTER
0965                           ;
0966 T 02E2 682C02DF                    DBNZ    RC,ASHFTC               ; LOOP FOR ALL BYTES
0967 T 02E6 1B                          INC     RB                              ; POINT TO LOW BYTE
0968                           ;****************************************************************************
0969                           ;
0970                           ;       A/D INPUT SECTION
0971                           ;
0972                           ;       A/D CHANNELS
0973                           ;
0974                           ;       CHANNEL 0 ALT RELIBILITY
0975                           ;       CHANNEL 1 100 FT RANGE ALT
0976                           ;       CHANNEL 2 1000 FT RANGE ALT
0977                           ;       CHANNEL 3 FEEDBACK POT
0978                           ;       CHANNEL 4 ACCELOERMETER
0979                           ;
0980                           ;****************************************************************************
0981 T 02E7 68C2447F           ADSETC:  RLDI    R2,INPUT            ; INPUT STACK
0982                           ;
0983 T 02EB 68C4437F                    RLDI    R4,ALTREL
0984 T 02EF 68C5436F                    RLDI    R5,ALTLOW
0985 T 02F3 68C6435F                    RLDI    R6,ALTHIH
0986 T 02F7 68C8434F                    RLDI    R8,FEDPOT
0987 T 02FB 68C9433F                    RLDI    R9,GLOADS
0988                           ;
0989 T 02FF E3                 ADGETC:  SEX     R3                  ; MAKE PC SP
0990 T 0300 61                          OUT     1                               ; SELECT I/O
0991 T 0301 30                          DB      $30
0992 T 0302 66                          OUT     6                               ; CHANNEL MODE
0993 T 0303 01                          DB      $01
0994 T 0304 65                          OUT     5                               ; RELIBILITY
0995 T 0305 00                          DB      $00
0996 T 0306 E2                          SEX     R2                              ; RESET SP
0997                           ;
0998 T 0307 3C07                        BN1     *                               ; WAIT
0999 T 0309 6C                          INP     4                               ; RELIBILITY
1000 T 030A 54                          STR     R4                              ; STASH
1001                           ;
1002 T 030B 3C0B                        BN1     *                               ; WAIT FOR FLAG
1003 T 030D 6C                          INP     4                               ; 100FT RANGE
1004 T 030E AF                          PLO     RF                              ; STASH INPUT
1005 T 030F 55                          STR     R5                              ; STASH
1006                           ;
1007 T 0310 3C10                        BN1     *                               ; WAIT
1008 T 0312 6C                          INP     4                               ; 500FT RANGE
1009 T 0313 A7                          PLO     R7                              ; STASH
1010 T 0314 56                          STR     R6                              ; STASH
1011                           ;
1012 T 0315 3C15                        BN1     *                               ; WAIT
1013 T 0317 6C                          INP     4                               ; WING POSITION
1014 T 0318 58                          STR     R8                              ; STASH
1015                           ;
1016 T 0319 3C19                        BN1     *                               ; WAIT
1017 T 031B 6B                          INP     3                               ; ACCELEROMETER
1018 T 031C 59                          STR     R9                              ; STASH
1019                           ;****************************************************************************
1020                           ;       AUTO-RANGE ALT INPUTS
1021                           ;****************************************************************************
1022 T 031D F800               AUTOC:   LDI     $00                     ; ZERO BYTE
1023 T 031F BF                          PHI     RF                              ; HIGH BYTE OF ALT
1024                           ;
1025 T 0320 8F                          GLO     RF                              ; GET 100FT RANGE
1026 T 0321 FDFF                        SDI     $FF                     ; MAX INPUT
1027 T 0323 CA0338                      LBNZ    STACKC                  ; IF NON-ZERO, LOW RANGE
1028                           ;****************************************************************************
1029                           ;       FULL SCALE RANGE
1030                           ;****************************************************************************
1031 T 0326 87                          GLO     R7                              ; HIGH RANGE ALT
1032 T 0327 AF                          PLO     RF                              ; SET LOW BYTE OF ALT
1033                           ;
1034 T 0328 68CD44FF                    RLDI    RD,UTIL                 ; SET MATH STACK
1035 T 032C ED                          SEX     RD                              ; MAKE RD SP
1036 T 032D F805                        LDI     $05                     ; LOW BYTE OF 5
1037 T 032F 73                          STXD                        ; PUT ON STACK
1038 T 0330 F800                        LDI     $00                     ; HIGH BYTE OF 5
1039 T 0332 5D                          STR     RD                              ; PUT ON STACK
1040                           ;
1041 T 0333 68C6074A                    RLDI    R6,MULT                 ; ADDRESS OF MULT
1042 T 0337 D6                          SEP     R6                              ; CALL MULT
1043                           ;****************************************************************************
1044                           ;       PUT CURRENT ALT ON STACK
1045                           ;****************************************************************************
1046 T 0338 8F                 STACKC:  GLO     RF                  ;
1047 T 0339 5B                          STR     RB                              ;
1048 T 033A 2B                          DEC     RB                              ;
1049 T 033B 9F                          GHI     RF                              ;
1050 T 033C 5B                          STR     RB                              ;
1051                           ;****************************************************************************
1052                           ;
1053                           ;       AVERAGE ALT INPUTS
1054                           ;
1055                           ;****************************************************************************
1056                           ;               DON'T AVERAGE IN MANUAL MODE
1057                           ;****************************************************************************
1058 T 033D 68CC46FF                    RLDI    RC,COMWRD
1059 T 0341 0C                          LDN     RC
1060 T 0342 FA07                        ANI     $07
1061 T 0344 FF06                        SMI     MANBIT
1062 T 0346 C20372                      LBZ     CALERC
1063                           ;****************************************************************************
1064                           ;       AVERAGE LAST 4 ALT SAMPLES
1065                           ;****************************************************************************
1066 T 0349 68CD41FF                    RLDI    RD,ATOP                 ; TOP OF ALT STACK
1067 T 034D 68CC0004                    RLDI    RC,$0004                ; NUMBER OF SAMPLES
1068 T 0351 68CF0000                    RLDI    RF,$0000                ; ZERO SUM
1069 T 0355 ED                          SEX     RD                              ; SET STACK
1070                           ;
1071 T 0356 8F                 AVGC:    GLO     RF                  ; GET LOW BYTE
1072 T 0357 F4                          ADD                         ; ADD TO ALT
1073 T 0358 AF                          PLO     RF                              ; RESET SUM
1074                           ;
1075 T 0359 2D                          DEC     RD                              ; POINT TO HIGH BYTE
1076                           ;
1077 T 035A 9F                          GHI     RF                              ; GET HIGH BYTE
1078 T 035B 74                          ADC                         ; ADD WITH DF
1079 T 035C BF                          PHI     RF                              ; RESET SUM
1080                           ;
1081 T 035D 2D                          DEC     RD                              ; POINT TO NEXT LOW BYTE
1082                           ;
1083 T 035E 682C0356                    DBNZ    RC,AVGC                 ; ADD ALL WORDS
1084                           ;
1085 T 0362 E2                          SEX     R2                              ; RESET STACK
1086 T 0363 68C60703                    RLDI    R6,USHR                 ; ADDRESS OF USHR
1087 T 0367 D6                          SEP     R6                              ; DIVIDE SUM BY 4
1088 T 0368 02                          DB      $02
1089                           ;****************************************************************************
1090                           ;       RESET CURRENT INPUT WITH AVERAGE
1091                           ;****************************************************************************
1092 T 0369 68CD41FF                    RLDI    RD,ATOP
1093 T 036D ED                          SEX     RD                              ; RESET SP
1094 T 036E 8F                          GLO     RF                              ; LOW BYTE
1095 T 036F 73                          STXD                        ; STACK IT
1096 T 0370 9F                          GHI     RF                              ; HIGH BYTE
1097 T 0371 5D                          STR     RD                              ; STACK IT
1098                           ;****************************************************************************
1099                           ;       CALCULATE ALT ERROR
1100                           ;****************************************************************************
1101 T 0372 68CD450F           CALERC:  RLDI    RD,PRESET           ; POINTER TO PRESET
1102 T 0376 ED                          SEX     RD                              ; SET STACK POINTER
1103                           ;
1104 T 0377 8F                          GLO     RF                              ; GET LOW BYTE OF ALT
1105 T 0378 F5                          SD                          ;
1106 T 0379 A9                          PLO     R9                              ;
1107                           ;
1108 T 037A 2D                          DEC     RD                              ;
1109                           ;
1110 T 037B 9F                          GHI     RF                              ; GET HIGH BYTE OF ALT
1111 T 037C 75                          SDB                         ;
1112 T 037D B9                          PHI     R9                              ;
1113                           ;****************************************************************************
1114                           ;
1115                           ;       DETERMINE +/- 50 FT ALT DEVIATION
1116                           ;
1117                           ;****************************************************************************
1118 T 037E 99                          GHI     R9                              ; CHECK SIGN OF ERROR
1119 T 037F FE                          SHL                         ;
1120 T 0380 C30393                      LBDF    AHIGHC                  ;
1121                           ;****************************************************************************
1122                           ;       LOW ON PRESET
1123                           ;****************************************************************************
1124 T 0383 99                          GHI     R9                              ;
1125 T 0384 CA038E                      LBNZ    MAXLC                   ;
1126                           ;
1127 T 0387 89                          GLO     R9                              ;
1128 T 0388 FC80                        ADI     $80                     ;
1129 T 038A C3038E                      LBDF    MAXLC                   ;
1130                           ;
1131 T 038D C8                          LSKP                        ;
1132                           ;
1133 T 038E F8FF               MAXLC:   LDI     $FF                 ;
1134 T 0390 C003A2                      LBR     OUTC                    ;
1135                           ;****************************************************************************
1136                           ;       HIGH ON PRESET
1137                           ;****************************************************************************
1138 T 0393 99                 AHIGHC:  GHI     R9                  ;
1139 T 0394 FFFF                        SMI     $FF                     ;
1140 T 0396 CA03A0                      LBNZ    MAXHC               ;
1141                           ;
1142 T 0399 89                          GLO     R9                              ;
1143                           
1144 T 039A FF80                        SMI     $80                     ;
1145 T 039C CB03A0                      LBNF    MAXHC                   ;
1146                           ;
1147 T 039F C8                          LSKP                        ;
1148                           ;
1149 T 03A0 F800               MAXHC:   LDI     $00
1150                           ;****************************************************************************
1151                           ;       OUTPUT ALT DEVIATION TO D/A CH 2
1152                           ;****************************************************************************
1153 T 03A2 FBFF               OUTC:    XRI     $FF                 ;
1154 T 03A4 52                          STR     R2                              ;
1155 T 03A5 E2                          SEX     R2                              ;
1156 T 03A6 64                          OUT     4                               ;
1157 T 03A7 22                          DEC     R2                              ;
1158                           ;****************************************************************************
1159                           ;
1160                           ;       RETURN TO COMMAND LINK
1161                           ;
1162                           ;****************************************************************************
1163 T 03A8 C00051                      LBR     GRABER
1164                           ;****************************************************************************
1165                           ;
1166                           ;       STASH VERSION NUMBER
1167                           ;
1168                           ;****************************************************************************
1169        00000001                    IF      (VERSION GT 3)
1170                           
1171 T 03F0                             ORG     $03F0
1172                           
1173 T 03F0 56455253494F4E              DB      'VERSION'
1174 T 03F7 05                          DB      VERSION
1175 T 03F8 000B035C                    DD      _DATE
1176                           
1177                                    ENDIF   
1178                           ;****************************************************************************
1179                           ;
1180                           ;
1181                           ;       TLX ACCEL CONTOLLER SOFTWARE
1182                           ;
1183                           ;
1184                           ;****************************************************************************
1185 T 0400                             ORG     $0400               ; EPROM NUMBER ONE
1186                           ;****************************************************************************
1187                           ;
1188                           ;       WING LIMITS
1189                           ;
1190                           ;       HARDWARE WING POSITION
1191                           ;       BASED ON FOLLOWING CALIBRATION
1192                           ;
1193                           ;       ANGLE  ANGLE     HEX  DEC  VOLTS
1194                           ;
1195                           ;       +1      +10      FF   255   2.5
1196                           ;        0       +9      E5   229   2.25
1197                           ;       -1       +8      CC   204   2.0
1198                           ;       -1.5     +7.5    BF   191   1.875
1199                           ;       -2       +7      B2   178   1.75
1200                           ;       -3       +6      99   153   1.5
1201                           ;       -4       +5      7F   127   1.25
1202                           ;       -4.5     +4.5    73   115   1.125
1203                           ;       -5       +4      66   102   1.0
1204                           ;       -6       +3      4C    76   0.75
1205                           ;       -7       +2      33    51   0.50
1206                           ;       -8       +1      19    25   0.25
1207                           ;       -8.5     +0.5    0C    12   0.125
1208                           ;       -9        0      00     0   0.0
1209                           ;
1210                           ;       SOFTWARE WING POSITION
1211                           ;       BASED ON THE FOLLOWING CONVENTION
1212                           ;
1213                           ;       ANGLE    HEX
1214                           ;
1215                           ;       +8       00CC + 00E5 = 01B1
1216                           ;        0       0000 + 00E5 = 00E5
1217                           ;       -8       FF34 + 00E5 = 0019
1218                           ;
1219                           ;****************************************************************************
1220                           ;       WING POSITON EQUATES
1221                           ;****************************************************************************
1222        000000E5           WNGPOS   EQU     $E5                 ; MAX POSITIVE (0 DEG)
1223        000000E5           WNGZER   EQU     $E5                 ; ZERO ANGLE (0 DEG)
1224        000000BF           WNGREC   EQU     $BF                 ; RECOVERY (-1.5 DEG)
1225                           
1226                           
1227        00000001                    IF      ((VERSION EQ VER_0) OR (VERSION EQ VER_1) OR (VERSION EQ VER_2) OR (VERSION EQ VER_4) OR (VERSION EQ VER_5))
1228                           
1229        00000019           WNGNEG   EQU     $19                     ; MAX NEGATIVE (-8.0 DEG)
1230                           
1232                                    ENDIF   
1233                           
1234        00000000                    IF      (VERSION EQ VER_3)
1239                                    ENDIF   
1240                           
1241        00000001                    IF      ((VERSION EQ VER_1) OR (VERSION EQ VER_2) OR (VERSION EQ VER_4) OR (VERSION EQ VER_5))
1242                           
1243        0000007F           WNGRET   EQU     $7F                     ; NORMAL MANUAL RESET (4.0 DEG - 9DEG = -5.0 DEG)
1244                           
1246                                    ENDIF   
1247                           
1248        00000000                    IF      (VERSION EQ VER_3)
1253                                    ENDIF   
1254                           
1255        00000001                    IF      (VERSION GT VER_2)
1256                           
1257        0000000C           WNGWIN   EQU     $0C                 ; WING WINDOW +/- 0.5 DEG
1258        00000073           WNGRL    EQU     WNGRET-WNGWIN       ; WNGRET - 0.5 DEG
1259        0000008B           WNGRH    EQU     WNGRET+WNGWIN       ; WNGRET + 0.5 DEG
1260                           
1261                                    ENDIF   
1262                           ;
1263        000000CC           WNGMAX   EQU     $00CC               ; ABS POS LIMIT (+8)
1264        0000FF34           WNGXRI   EQU     $FF34               ; ABS NEG LIMIT (-8)
1265                           ;****************************************************************************
1266                           ;
1267                           ;       ACCELEROMETER SCALING
1268                           ;
1269                           ;       G'S    HEX    DEC    VOLTS
1270                           ;
1271                           ;       +1.5   FF     255     2.5
1272                           ;       +1.25  BF     191     1.875
1273                           ;       +1     7F     127     1.25
1274                           ;       +0.75  3F      63     0.625
1275                           ;       +0.5   00       0     0.0
1276                           ;
1277                           ;****************************************************************************
1278                           ;
1279                           ;       TLX ACCEL CONTROLLER
1280                           ;
1281                           ;****************************************************************************
1282 T 0400 C4                 TLXACC:  NOP     
1283                           ;****************************************************************************
1284                           ;       ZERO ACCEL STACK
1285                           ;****************************************************************************
1286 T 0401 68CD42FF           ACCZER:  RLDI    RD,CTOP             ; TOP OF ACCEL STACK
1287 T 0405 68CC0020                    RLDI    RC,CBYTE                ; NUMBER BYTES
1288 T 0409 ED                          SEX     RD                              ; SET STACK
1289 T 040A F800                        LDI     $00                     ; ZERO G'S
1290                           ;
1291 T 040C 73                 ZEROC1:  STXD                        ; STORE BYTE
1292                           ;
1293 T 040D 682C040C                    DBNZ    RC,ZEROC1               ; ZERO ALL BYTES
1294                           ;****************************************************************************
1295                           ;       SET COUNTER FOR FOUR CYCLES
1296                           ;****************************************************************************
1297 T 0411 68CD43FF                    RLDI    RD,COUNT
1298 T 0415 F804                        LDI     $04
1299 T 0417 5D                          STR     RD
1300                           ;****************************************************************************
1301                           ;       INITIALIZE PRESET FLAG
1302                           ;****************************************************************************
1303        00000000                    IF      ((VERSION GT VER_2) AND (VERSION LT VER_5))
1310                                    ENDIF   
1311                           ;****************************************************************************
1312                           ;
1313                           ;       DELAY LOOP SECTION
1314                           ;
1315                           ;       DELAY LOOP FOR PROGRAM EXECUTION
1316                           ;       OF 0.25 SECONDS PER CYCLE.
1317                           ;       POLL THE HALT SWITCH WHILE
1318                           ;       WAITING, USING THE EF3 FLAG .
1319                           ;
1320                           ;****************************************************************************
1321 T 0418 68CF0167           LOWALT:  RLDI    RF,$0167            ; DELAY COUNTER
1322 T 041C 3E39               LOWHLT:  BN3     HALT
1323 T 041E 3E39                        BN3     HALT
1324 T 0420 3E39                        BN3     HALT
1325 T 0422 3E39                        BN3     HALT
1326                           ;
1327 T 0424 3E39                        BN3     HALT
1328 T 0426 3E39                        BN3     HALT
1329 T 0428 3E39                        BN3     HALT
1330 T 042A 3E39                        BN3     HALT
1331                           ;
1332 T 042C 682F041C                    DBNZ    RF,LOWHLT               ; DECREMENT DELAY COUNT
1333 T 0430 303C                        BR      TLXFLY
1334                           ;****************************************************************************
1335                           ;
1336                           ;       DEBUG:CYCLE TIMER
1337                           ;
1338                           ;       NOP OUT ABOVE BRANCH AND STOP
1339                           ;       CLOCK COUNTER. USES Q OUTPUT
1340                           ;       TO INDICATE CONTROL LOOP
1341                           ;
1342                           ;****************************************************************************
1343 T 0432 CD                          LSQ                         ; SKIP NEXT 2 IF Q=1
1344                           ;
1345 T 0433 7B                          SEQ                         ; SET Q=1
1346 T 0434 C8                          LSKP                        ; SKIP NEXT 2
1347                           ;
1348 T 0435 7A                          REQ                         ; SET Q=0
1349 T 0436 7A                          REQ                         ; EVEN OUT LOOP
1350                           ;
1351 T 0437 303E                        BR      CLTSHF
1352                           ;****************************************************************************
1353                           ;       JUMP TO COMMAND LINK
1354                           ;****************************************************************************
1355        00000001                    IF      (VERSION GT VER_3)
1356                           
1357 T 0439 C00A43             HALT:    LBR     HALTPAT             ;                BRANCH TO PATCH AREA
1358                           
1363                                    ENDIF   
1364                           ;****************************************************************************
1365                           ; CONTROL LOOP
1366                           ;****************************************************************************
1367 T 043C C4                 TLXFLY:  NOP                         ; NO OPERATION
1368 T 043D C4                          NOP                         ; NO OPERATION
1369                           ;****************************************************************************
1370                           ;       SHIFT ALT STACK DOWN ONE ENTRY
1371                           ;****************************************************************************
1372 T 043E 68CA41E2           CLTSHF:  RLDI    RA,ABOT+$02         ; BOTTOM OF STACK+2
1373 T 0442 68CB41E0                    RLDI    RB,ABOT                 ; BOTTOM STACK
1374 T 0446 68CC001E                    RLDI    RC,ABYTE-$02        ; NUMBER BYTES-2
1375 T 044A EA                          SEX     RA                              ; RA IS SP
1376                           ;
1377 T 044B 72                 CAHFT:   LDXA                        ; GET BYTE
1378 T 044C 5B                          STR     RB                              ; MOVE DOWN
1379 T 044D 1B                          INC     RB                              ; INCREMENT POINTER
1380                           ;
1381 T 044E 682C044B                    DBNZ    RC,CAHFT                ; LOOP FOR ALL BYTES
1382 T 0452 1B                          INC     RB                              ; POINT TO LOW BYTE
1383                           ;****************************************************************************
1384                           ;       SHIFT ACCEL STACK DOWN ONE ENTRY
1385                           ;****************************************************************************
1386 T 0453 68C742E2           CELSFT:  RLDI    R7,CBOT+$02         ; BOTTOM OF STACK+2
1387 T 0457 68C842E0                    RLDI    R8,CBOT                 ; BOTTOM STACK
1388 T 045B 68C9001E                    RLDI    R9,CBYTE-$02        ; NUMBER BYTES-2
1389 T 045F E7                          SEX     R7                              ; R7 IS SP
1390                           ;
1391 T 0460 72                 CSHFT:   LDXA                        ; GET BYTE
1392 T 0461 58                          STR     R8                              ; MOVE DOWN
1393 T 0462 18                          INC     R8                              ; INCREMENT POINTER
1394                           ;
1395 T 0463 68290460                    DBNZ    R9,CSHFT                ; LOOP FOR ALL BYTES
1396 T 0467 18                          INC     R8                              ; POINT TO LOW BYTE
1397                           ;****************************************************************************
1398                           ;
1399                           ;       A/D INPUT SECTION
1400                           ;
1401                           ;****************************************************************************
1402 T 0468 68C2447F           ADSET:   RLDI    R2,INPUT            ; INPUT STACK
1403                           ;
1404 T 046C E3                          SEX     R3                              ; MAKE PC SP
1405 T 046D 61                          OUT     1                               ; SELECT I/O
1406 T 046E 30                          DB      $30
1407 T 046F 66                          OUT     6                               ; SCAN MODE
1408 T 0470 01                          DB      $01
1409 T 0471 65                          OUT     5                               ; START AT CH 0
1410 T 0472 00                          DB      $00
1411 T 0473 E2                          SEX     R2                              ; RESET SP
1412                           ;
1413 T 0474 3C74                        BN1     *                               ; WAIT FOR FLAG
1414                           ;
1415 T 0476 6C                          INP     4                               ; INPUT RELIBILITY
1416 T 0477 FF80                        SMI     $80
1417 T 0479 CB063A                      LBNF    ABORTR
1418                           ;****************************************************************************
1419                           ;       RELIBILITY OK
1420                           ;****************************************************************************
1421 T 047C 3C7C               RELOK:   BN1     *                   ; WAIT FOR FLAG
1422                           ;
1423 T 047E 6C                          INP     4                               ; 100FT RANGE
1424 T 047F AF                          PLO     RF                              ; STASH
1425                           ;
1426 T 0480 3C80                        BN1     *                               ; WAIT FOR FLAG
1427                           ;
1428 T 0482 6C                          INP     4                               ; 1000FT RANGE
1429 T 0483 A7                          PLO     R7                              ; STASH
1430                           ;****************************************************************************
1431 T 0484 3C84                        BN1     *                               ; WAIT FOR FLAG
1432 T 0486 6C                          INP     4                               ; WING POSITION
1433                           
1434        00000001                    IF      (VERSION GT VER_2)
1435                           
1436 T 0487 A0                          PLO     R0                              ; STASH
1437                           
1438                                    ENDIF   
1439                           ;****************************************************************************
1440 T 0488 3C88                        BN1     *                               ; WAIT
1441 T 048A 6B                          INP     3                               ; ACCEL
1442                           ;****************************************************************************
1443                           ;
1444                           ;       SUBTRACT +1 G BIAS ($007F)
1445                           ;
1446                           ;****************************************************************************
1447 T 048B FF7F               BIAS:    SMI     $7F                 ; BIAS
1448 T 048D 58                          STR     R8                              ; STACK IT
1449 T 048E 28                          DEC     R8                              ; HIGH BYTE
1450 T 048F F800                        LDI     $00                     ; ZERO BYTE
1451 T 0491 7F00                        SMBI    $00                     ; BIAS
1452 T 0493 58                          STR     R8                              ; STACK IT
1453                           ;****************************************************************************
1454                           ;       AUTO-RANGE ALT INPUTS
1455                           ;****************************************************************************
1456 T 0494 F800               AUTO:    LDI     $00                 ; ZERO BYTE
1457 T 0496 BF                          PHI     RF                              ; HIGH BYTE OF ALT
1458                           ;
1459 T 0497 8F                          GLO     RF                              ; LOW RANGE ALT
1460 T 0498 FDFF                        SDI     $FF                     ; SUBTRACT MAX VALVE
1461 T 049A 3AAE                        BNZ     STACKA                  ; IF NOT MAX USE LOW RANGE
1462                           ;****************************************************************************
1463                           ;       FULL SCALE RANGE
1464                           ;****************************************************************************
1465 T 049C 87                          GLO     R7                              ; HIGH RANGE ALT
1466 T 049D AF                          PLO     RF                              ; SET LOW BYTE OF ALT
1467                           ;
1468 T 049E 68CD44FF                    RLDI    RD,UTIL                 ; SET MATH STACK
1469 T 04A2 ED                          SEX     RD                              ; MAKE RD SP
1470 T 04A3 F805                        LDI     $05                     ; LOW BYTE OF 5
1471 T 04A5 73                          STXD                        ; PUT ON STACK
1472 T 04A6 F800                        LDI     $00                     ; HIGH BYTE OF 5
1473 T 04A8 5D                          STR     RD                              ; PUT ON STACK
1474                           ;
1475 T 04A9 68C6074A                    RLDI    R6,MULT                 ; ADDRESS OF MULT
1476 T 04AD D6                          SEP     R6                              ; CALL MULT
1477                           ;****************************************************************************
1478                           ;       PUT CURRENT ALT ON STACK
1479                           ;****************************************************************************
1480 T 04AE 8F                 STACKA:  GLO     RF                  ;
1481 T 04AF 5B                          STR     RB                              ;
1482 T 04B0 2B                          DEC     RB                              ;
1483 T 04B1 9F                          GHI     RF                              ;
1484 T 04B2 5B                          STR     RB                              ;
1485                           ;****************************************************************************
1486                           ;       CHECK FOR ALT < 8 FT
1487                           ;****************************************************************************
1488 T 04B3 87                          GLO     R7                              ; HIGH RANGE
1489 T 04B4 FF04                        SMI     $04                     ; SUB 8FT
1490 T 04B6 CB0635                      LBNF    ABORTL                  ; IF BORROW ABORT
1491                           ;****************************************************************************
1492                           ;       AVERAGE 4 ALT SAMPLES
1493                           ;****************************************************************************
1494 T 04B9 68CD41FF                    RLDI    RD,ATOP                 ; TOP OF ALT STACK
1495 T 04BD 68CC0004                    RLDI    RC,$0004                ; NUMBER OF SAMPLES
1496 T 04C1 68CF0000                    RLDI    RF,$0000                ; ZERO SUM
1497 T 04C5 ED                          SEX     RD                              ; SET STACK
1498                           ;
1499 T 04C6 8F                 AVG:     GLO     RF                  ; GET LOW BYTE
1500 T 04C7 F4                          ADD                         ; ADD TO ALT
1501 T 04C8 AF                          PLO     RF                              ; RESET SUM
1502                           ;
1503 T 04C9 2D                          DEC     RD                              ; POINT TO HIGH BYTE
1504                           ;
1505 T 04CA 9F                          GHI     RF                              ; GET HIGH BYTE
1506 T 04CB 74                          ADC                         ; ADD WITH DF
1507 T 04CC BF                          PHI     RF                              ; RESET SUM
1508                           ;
1509 T 04CD 2D                          DEC     RD                              ; POINT TO NEXT LOW BYTE
1510                           ;
1511 T 04CE 682C04C6                    DBNZ    RC,AVG                  ; ADD ALL WORDS
1512                           ;
1513 T 04D2 E2                          SEX     R2                              ; RESET STACK
1514 T 04D3 68C60703                    RLDI    R6,USHR                 ; ADDRESS OF USHR
1515 T 04D7 D6                          SEP     R6                              ; DIVIDE SUM BY 4
1516 T 04D8 02                          DB      $02
1517                           ;****************************************************************************
1518                           ;       RESET CURRENT INPUT WITH AVERAGE
1519                           ;****************************************************************************
1520 T 04D9 68CD41FF                    RLDI    RD,ATOP
1521 T 04DD ED                          SEX     RD                              ; RESET SP
1522 T 04DE 8F                          GLO     RF                              ; LOW BYTE
1523 T 04DF 73                          STXD                        ; STACK IT
1524 T 04E0 9F                          GHI     RF                              ; HIGH BYTE
1525 T 04E1 5D                          STR     RD                              ; STACK IT
1526                           ;****************************************************************************
1527                           ;       CALCULATE ALT ERROR
1528                           ;****************************************************************************
1529 T 04E2 68CD450F           CALERR:  RLDI    RD,PRESET           ; POINTER TO PRESET
1530 T 04E6 ED                          SEX     RD                              ; SET STACK POINTER
1531                           ;
1532 T 04E7 8F                          GLO     RF                              ; GET LOW BYTE OF ALT
1533 T 04E8 F5                          SD                          ;
1534                           ;
1535 T 04E9 AF                          PLO     RF                              ;
1536 T 04EA A9                          PLO     R9                              ;
1537                           ;
1538 T 04EB 2D                          DEC     RD                              ;
1539                           ;
1540 T 04EC 9F                          GHI     RF                              ; GET HIGH BYTE OF ALT
1541 T 04ED 75                          SDB                         ;
1542                           ;
1543 T 04EE BF                          PHI     RF                              ;
1544 T 04EF B9                          PHI     R9                              ;
1545                           ;****************************************************************************
1546                           ;       DETERMINE +/- 50 FT ALT DEVIATION
1547                           ;****************************************************************************
1548 T 04F0 99                 DETDEV:  GHI     R9                  ; CHECK SIGN OF ERROR
1549 T 04F1 FE                          SHL                         ;
1550 T 04F2 C30502                      LBDF    AHIGH                   ;
1551                           ;****************************************************************************
1552                           ;       LOW ON PRESET
1553                           ;****************************************************************************
1554        00000000                    IF      ((VERSION GT VER_2) AND (VERSION LT VER_5))
1574                                    ENDIF   
1575                           ;****************************************************************************
1576                           ;       LOW ON PRESET
1577                           ;****************************************************************************
1578 T 04F5 99                 01$:     GHI     R9                  ;
1579 T 04F6 3AFE                        BNZ     MAXL                    ;
1580                           ;
1581 T 04F8 89                          GLO     R9                              ;
1582 T 04F9 FC80                        ADI     $80                     ;
1583 T 04FB 33FE                        BDF     MAXL                    ;
1584                           ;
1585 T 04FD C8                          LSKP                        ;
1586                           ;
1587 T 04FE F8FF               MAXL:    LDI     $FF                 ;
1588 T 0500 300F                        BR      OUT                     ;
1589                           ;****************************************************************************
1590                           ;       HIGH ON PRESET
1591                           ;****************************************************************************
1592 T 0502 99                 AHIGH:   GHI     R9                  ;
1593 T 0503 FFFF                        SMI     $FF                     ;
1594 T 0505 3A0D                        BNZ     MAXH                    ;
1595                           ;
1596 T 0507 89                          GLO     R9                              ;
1597 T 0508 FF80                        SMI     $80                     ;
1598 T 050A 3B0D                        BNF     MAXH                    ;
1599                           ;
1600        00000000                    IF      (VERSION EQ VER_4)
1608                                    ELSE    
1609                           
1610 T 050C C8                          LSKP                        ; SKIP NEXT INSTRUNCTION
1611 T 050D F800               MAXH:    LDI     $00
1612                           
1613                                    ENDIF   
1614                           ;****************************************************************************
1615                           ;       OUTPUT ALT DEVIATION TO D/A CH 2
1616                           ;****************************************************************************
1617 T 050F FBFF               OUT:     XRI     $FF                 ; INVERT ALT DEVIATION
1618 T 0511 52                          STR     R2                              ; STACK IT
1619 T 0512 E2                          SEX     R2                              ; MAKE R2 STACK
1620 T 0513 64                          OUT     4                               ; OUTPUT ALT DEVIATION FROM STACK
1621 T 0514 22                          DEC     R2                              ; RESET STACK POINTER
1622                           ;****************************************************************************
1623                           ;       GAIN ALT ERROR (KP*ERROR)
1624                           ;****************************************************************************
1625 T 0515 68CD451E                    RLDI    RD,EGAIN-1              ; POINT TO HIGH BYTE
1626 T 0519 68C6074A                    RLDI    R6,MULT                 ; ADDRESS OF MULT
1627 T 051D ED                          SEX     RD                              ; RD IS SP
1628 T 051E D6                          SEP     R6                              ; CALL MULT
1629                           ;****************************************************************************
1630                           ;       STORE RESULT (RE,RF) IN R0,R1
1631                           ;****************************************************************************
1632 T 051F 9E                          GHI     RE                              ;
1633 T 0520 B0                          PHI     R0                              ;
1634                           ;
1635 T 0521 8E                          GLO     RE                              ;
1636 T 0522 A0                          PLO     R0                              ;
1637                           ;
1638 T 0523 9F                          GHI     RF                              ;
1639 T 0524 B1                          PHI     R1                              ;
1640                           ;
1641 T 0525 8F                          GLO     RF                              ;
1642 T 0526 A1                          PLO     R1                              ;
1643                           ;****************************************************************************
1644                           ;       DETERMINE ALT(N)-ALT(1)
1645                           ;
1646                           ;       THIS IS REVERSED SO THAT AN UPWARD
1647                           ;       ALT CHANGE WITH YIELD A NEGATIVE
1648                           ;       WING ANGLE
1649                           ;****************************************************************************
1650 T 0527 68CD41FF           ARATE:   RLDI    RD,ATOP             ; ALT(1)
1651 T 052B 68CC41E1                    RLDI    RC,ABOT+$01         ; ALT(N)
1652 T 052F ED                          SEX     RD
1653                           ;
1654 T 0530 0C                          LDN     RC
1655 T 0531 F7                          SM                          ; (N)-(1)
1656 T 0532 AF                          PLO     RF                              ; STORE
1657                           ;
1658 T 0533 2D                          DEC     RD                              ; POINT TO HIGH BYTE
1659 T 0534 2C                          DEC     RC                              ; POINT TO HIGH BYTE
1660                           ;
1661 T 0535 0C                          LDN     RC                              ; HIGH BYTE
1662 T 0536 77                          SMB                         ; HIGH BYTE
1663 T 0537 BF                          PHI     RF                              ; STORE
1664                           ;****************************************************************************
1665                           ;       DIVIDE ALT DIFFERENCE BY N*0.0625
1666                           ;       WITH N=15 THEN IS APPROXIMATELY
1667                           ;       EQUAL TO 1, THEREFORE NO OPERATION
1668                           ;****************************************************************************
1669 T 0538 C4                          NOP     
1670 T 0539 C4                          NOP     
1671 T 053A C4                          NOP     
1672                           ;****************************************************************************
1673                           ;       GAIN ALT DIFF (KV* DIFF)
1674                           ;****************************************************************************
1675 T 053B 68CD452E                    RLDI    RD,RGAIN-1              ; POINT TO HIGH BYTE
1676 T 053F 68C6074A                    RLDI    R6,MULT                 ; ADDRESS OF MULT
1677 T 0543 ED                          SEX     RD                              ; MAKE RD STACK
1678 T 0544 D6                          SEP     R6                              ; CALL MULT
1679                           ;****************************************************************************
1680                           ;       ADD KP*ERROR + KV*ALT DIFF
1681                           ;****************************************************************************
1682 T 0545 68C60735                    RLDI    R6,ADDER                ; ADDRESS OF ADDER
1683 T 0549 E2                          SEX     R2                              ; RESET STACK
1684 T 054A D6                          SEP     R6                              ; CALL ADDER
1685                           ;****************************************************************************
1686                           ; AVERAGE ACCEL INPUT
1687                           ;****************************************************************************
1688 T 054B 68CB42FF           ACCEL:   RLDI    RB,CTOP             ; ACCEL STACK
1689 T 054F 68CC0004                    RLDI    RC,$0004                ; 4 AVERAGES
1690 T 0553 68CF0000                    RLDI    RF,$0000                ; ZERO SUM
1691 T 0557 EB                          SEX     RB                              ; SET STACK
1692                           ;
1693 T 0558 8F                 CELAVG:  GLO     RF                  ; LOW BYTE
1694 T 0559 F4                          ADD                         ; ADD LOW BYTES
1695 T 055A AF                          PLO     RF                              ; RESET SUM
1696                           ;
1697 T 055B 2B                          DEC     RB                              ; POINT TO HIGH BYTE
1698                           ;
1699 T 055C 9F                          GHI     RF                              ; HIGH BYTE
1700 T 055D 74                          ADC                         ; ADD HIGH BYTES
1701 T 055E BF                          PHI     RF                              ; RESET SUM
1702                           ;
1703 T 055F 2B                          DEC     RB                              ; POINT TO NEXT LOW
1704                           ;
1705 T 0560 682C0558                    DBNZ    RC,CELAVG               ; ADD UP FOUR INPUTS
1706                           ;
1707 T 0564 E2                          SEX     R2                              ; RESET SP
1708 T 0565 68C60710                    RLDI    R6,ASHR                 ; ADDRESS OF ASHR
1709 T 0569 D6                          SEP     R6
1710 T 056A 02                          DB      $02
1711                           ;
1712 T 056B 68CB42FF                    RLDI    RB,CTOP
1713 T 056F 8F                          GLO     RF                              ; LOW BYTE
1714 T 0570 5B                          STR     RB                              ; STACK IT
1715 T 0571 2B                          DEC     RB                              ; POINT TO HIGH
1716 T 0572 9F                          GHI     RF                              ; HIGH BYTE
1717 T 0573 5B                          STR     RB                              ; STACK IT
1718                           ;****************************************************************************
1719                           ;       DOUBLE INTEGRATE THE ACCEL
1720                           ;****************************************************************************
1721 T 0574 68CD43FF           DOUBLE:  RLDI    RD,COUNT            ; POINT TO COUNT
1722 T 0578 0D                          LDN     RD                              ; LOAD COUNT
1723 T 0579 FF01                        SMI     $01                     ; COUNT-1
1724 T 057B 5D                          STR     RD                              ; RESET COUNT
1725 T 057C CA0418                      LBNZ    LOWALT                  ; LOOP TILL ZERO
1726 T 057F F804                        LDI     $04                     ; 4 CYCLES
1727 T 0581 5D                          STR     RD                              ; RESET COUNT
1728                           ;****************************************************************************
1729                           ;       INTEGRATE ACCEL
1730                           ;****************************************************************************
1731 T 0582 68CB42FF                    RLDI    RB,CTOP                 ; ACCEL STACK
1732 T 0586 68CA0010                    RLDI    RA,CBYTE2               ; NUMBER WORBS
1733 T 058A 68C90000                    RLDI    R9,$0000                ; DOUBLE SUM
1734 T 058E ED                          SEX     RD                              ; SET MATH STACK
1735                           ;
1736 T 058F 0B                 CCEL:    LDN     RB                              ; GET LOW BYTE
1737 T 0590 AF                          PLO     RF                              ; STORE
1738 T 0591 2B                          DEC     RB                              ; POINT TO HIGH BYTE
1739 T 0592 0B                          LDN     RB                              ; GET HIGH BYTE
1740 T 0593 BF                          PHI     RF                              ; STORE
1741 T 0594 2B                          DEC     RB                              ; NEXT LOW BYTE
1742                           ;
1743 T 0595 68CD44FF                    RLDI    RD,UTIL                 ; SET STACK
1744 T 0599 8A                          GLO     RA                              ; LOW COUNT
1745 T 059A 73                          STXD                        ; STACK IT
1746 T 059B 9A                          GHI     RA                              ; HIGH COUNT
1747 T 059C 5D                          STR     RD                              ; STACK IT
1748 T 059D 68C6074A                    RLDI    R6,MULT                 ; ADDRESS OF MULT
1749 T 05A1 D6                          SEP     R6                              ; MULT
1750                           ;
1751 T 05A2 8F                          GLO     RF                              ; LOW BYTE
1752 T 05A3 5D                          STR     RD                              ; STACK IT
1753 T 05A4 89                          GLO     R9                              ; LOW BYTE
1754 T 05A5 F4                          ADD                         ; ADD LOW BYTES
1755 T 05A6 A9                          PLO     R9                              ; RESET SUM
1756                           ;
1757 T 05A7 9F                          GHI     RF                              ; HIGH BYTE
1758 T 05A8 5D                          STR     RD                              ; STACK IT
1759 T 05A9 99                          GHI     R9                              ; HIGH BYTE
1760 T 05AA 74                          ADC                         ; ADD HIGH BYTES
1761 T 05AB B9                          PHI     R9                              ; RESET SUM
1762                           ;
1763 T 05AC 682A058F                    DBNZ    RA,CCEL                 ; SUM STACK
1764                           ;
1765 T 05B0 89                          GLO     R9                              ; LOW BYTE
1766 T 05B1 AF                          PLO     RF                              ;
1767 T 05B2 99                          GHI     R9                              ; HIGH BYTE
1768 T 05B3 BF                          PHI     RF                              ;
1769                           ;****************************************************************************
1770                           ;       MULT ACCEL INTEGRAL BY 0.0625**2
1771                           ;       AND DIVIDE BY 15*0.0625
1772                           ;       WHICH IS APPROXIMATELY 2**(-8)
1773                           ;****************************************************************************
1774 T 05B4 68C60710                    RLDI    R6,ASHR                 ; ADDRESS OF ASHR
1775 T 05B8 D6                          SEP     R6                              ; CALL ASHR
1776 T 05B9 08                          DB      $08                     ; NUMBER OF RIGHT SHIFTS
1777                           ;****************************************************************************
1778                           ;       GAIN ACCEL INTEGRAL (KV* ACCEL)
1779                           ;****************************************************************************
1780 T 05BA 68CD453E                    RLDI    RD,IGAIN-1              ; POINT TO HIGH BYTE
1781 T 05BE 68C6074A                    RLDI    R6,MULT                 ; ADDRESS OF MULT
1782 T 05C2 ED                          SEX     RD                              ; MAKE RD STACK
1783 T 05C3 D6                          SEP     R6                              ; CALL MULT
1784                           ;****************************************************************************
1785                           ;       ADD KP*ERROR + KV*ACCEL INTEGRAL
1786                           ;****************************************************************************
1787 T 05C4 68C60735                    RLDI    R6,ADDER                ; ADDRESS OF ADDER
1788 T 05C8 E2                          SEX     R2                              ; RESET STACK
1789 T 05C9 D6                          SEP     R6                              ; CALL ADDER
1790                           ;****************************************************************************
1791                           ;       WING COMMAND SECTION
1792                           ;****************************************************************************
1793 T 05CA 68C244FF           WING:    RLDI    R2,UTIL             ; MATH STACK
1794 T 05CE E2                          SEX     R2                              ; SETUP STACK
1795                           ;
1796 T 05CF 68CD454F                    RLDI    RD,SGAIN                ; SCALE FACTOR
1797 T 05D3 0D                          LDN     RD                              ; GET SCALE
1798 T 05D4 F6                          SHR                         ; DIVIDE BY 16
1799 T 05D5 F6                          SHR     
1800 T 05D6 F6                          SHR     
1801 T 05D7 F6                          SHR     
1802 T 05D8 AD                          PLO     RD                              ; STORE
1803                           ;****************************************************************************
1804                           ;       DIVIDE BY 2**SCALE
1805                           ;****************************************************************************
1806 T 05D9 68C6071F                    RLDI    R6,SCALE                ; ADDRESS OF SCALE
1807 T 05DD D6                          SEP     R6                              ; CALL SCALE
1808                           ;****************************************************************************
1809                           ;       CHECK WING COMMAND FOR OVERFLOW
1810                           ;****************************************************************************
1811 T 05DE 90                 OVERFL:  GHI     R0                  ; GET MSB
1812 T 05DF FE                          SHL                         ; PUT SIGN IN DF
1813                           
1814        00000001                    IF      (VERSION LT VER_3) OR (VERSION EQ VER_5)
1815                           
1816 T 05E0 33EF                        BDF     NEGWNG                  ; IF NEG BRANCH
1817                           
1822                                    ENDIF   
1823                           
1824 T 05E2 91                          GHI     R1                              ; GET HIGH BYTE
1825 T 05E3 3AE9                        BNZ     POSOVF                  ; IF NOT ZERO OVERFLOW
1826 T 05E5 81                          GLO     R1                              ; GET LOW BYTE
1827 T 05E6 FE                          SHL                         ; PUT BIT 7 IN DF
1828 T 05E7 3BFC                        BNF     _OFFSET                 ; IF ZERO OK
1829 T 05E9 68C100CC           POSOVF:  RLDI    R1,WNGMAX           ; MAXIMUM (+)
1830 T 05ED 30FC                        BR      _OFFSET                 ; ADD IN OFFSET
1831                           ;
1832 T 05EF 91                 NEGWNG:  GHI     R1                  ; GET HIGH BYTE
1833 T 05F0 FDFF                        SDI     $FF                     ; SUBTRACK NEG BITS
1834 T 05F2 3AF8                        BNZ     NEGOVF                  ; IF NOT ZERO OVERFLOW
1835 T 05F4 81                          GLO     R1                              ; GET LOW BYTE
1836 T 05F5 FE                          SHL                         ; PUT SIGN IN DF
1837 T 05F6 33FC                        BDF     _OFFSET                 ; IF SET OK
1838 T 05F8 68C1FF34           NEGOVF:  RLDI    R1,WNGXRI           ; MAXIMUM (-)
1839                           ;****************************************************************************
1840                           ;       ADD IN HARDWARE OFFSET
1841                           ;****************************************************************************
1842 T 05FC                    _OFFSET:         
1843 T 05FC 81                          GLO     R1                              ; GET WING COMMAND
1844 T 05FD FCE5                        ADI     LOW(WNGZER)         ; ADD OFFSET
1845 T 05FF A1                          PLO     R1                              ; RESET COMMAND
1846 T 0600 91                          GHI     R1                              ; GET HIGH BYET
1847 T 0601 7C00                        ADCI    HIGH(WNGZER)        ; ADD OFFSET HIGH BYTE
1848 T 0603 B1                          PHI     R1                              ; RESET HIGH BYTE
1849                           ;****************************************************************************
1850                           ;       SUBTRACT MANUAL RESET
1851                           ;****************************************************************************
1852 T 0604 68CD455F           SUBMAN:  RLDI    RD,RESET            ; MANUAL RESET
1853 T 0608 0D                          LDN     RD                              ; GET RESET
1854 T 0609 52                          STR     R2                              ; STACK IT
1855                           ;
1856 T 060A 81                          GLO     R1                              ; GET WING POSITION
1857 T 060B F7                          SM                          ; SUBTRACT MR
1858 T 060C A1                          PLO     R1                              ; RESET WING POSITION
1859 T 060D 91                          GHI     R1                              ; HIGH BYTE
1860 T 060E 7F00                        SMBI    $00                     ; HIGH BYTE OF LIMIT
1861 T 0610 B1                          PHI     R1                              ; RESET HIGH BYTE
1862                           ;****************************************************************************
1863                           ;       SOFTWARE LIMIT SWITCHES
1864                           ;****************************************************************************
1865 T 0611 91                 SOFT:    GHI     R1                  ; CHECK HIGH BYTE
1866 T 0612 3219                        BZ      SOFT1                   ; IF ZERO IN LIMITS
1867                           ;
1868 T 0614 FE                          SHL                         ; PUT SIGN IN DF
1869 T 0615 3328                        BDF     STOP                    ; NEG OVERFLOW
1870 T 0617 3025                        BR      LIMIT                   ; POS OVERFLOW
1871                           ;
1872 T 0619 81                 SOFT1:   GLO     R1                  ; GET COMMAND
1873 T 061A FF19                        SMI     LOW(WNGNEG)         ; - LIMIT
1874 T 061C 3B28                        BNF     STOP                    ; IF DF=0 LIMIT
1875                           ;
1876 T 061E 81                          GLO     R1                              ; GET COMMAND
1877 T 061F FFE5                        SMI     LOW(WNGPOS)         ; + LIMIT
1878 T 0621 3325                        BDF     LIMIT                   ; IF DF=1 LIMIT
1879                           ;
1880 T 0623 81                          GLO     R1                              ; GET COMMAND
1881                           ;
1882 T 0624 C8                          LSKP                        ; SKIP NEXT
1883                           ;
1884 T 0625 F8E5               LIMIT:   LDI     LOW(WNGPOS)         ; MAXIMUM + LIMIT
1885                           ;
1886 T 0627 C8                          LSKP                        ; SKIP NEXT
1887                           ;
1888 T 0628 F819               STOP:    LDI     LOW(WNGNEG)         ; MAXIMUM - LIMIT
1889                           ;****************************************************************************
1890                           ; OUTPUT TO SERVO
1891                           ;****************************************************************************
1892 T 062A 52                 SERVO:   STR     R2                  ; STACK IT
1893 T 062B 63                          OUT     3                               ; OUT D/A CH 1
1894 T 062C 22                          DEC     R2                              ; RESET STACK
1895                           ;****************************************************************************
1896                           ; CYCLE CONTROLLER
1897                           ;****************************************************************************
1898 T 062D C00418                      LBR     LOWALT
1899                           ;****************************************************************************
1900                           ;
1901                           ; END OF CONTROLLER SECTION
1902                           ;
1903                           ;****************************************************************************
1904                           ;
1905                           ;       ABORT CONTROLLER
1906                           ;
1907                           ;****************************************************************************
1908                           ;       ABORT ON HALT SWITCH
1909                           ;****************************************************************************
1910 T 0630 F800               ABORTP:  LDI     $00                 ; HALT FLAG
1911 T 0632 AC                          PLO     RC                  ; SET ABORT FLAG
1912                           
1913        00000001                    IF      (VERSION GT VER_2)
1914                           
1915 T 0633 303F                        BR      ABORT               ; BRANCH
1916                           
1922                                    ENDIF   
1923                           ;****************************************************************************
1924                           ;       ABORT IF ALT LESS THAN 8 FT
1925                           ;****************************************************************************
1926 T 0635 F801               ABORTL:  LDI     $01                 ; ABOTRL FLAG
1927 T 0637 AC                          PLO     RC                  ; SET ABORT FLAG
1928 T 0638 303F                        BR      ABORT               ; BRANCH
1929                           ;****************************************************************************
1930                           ;       ABORT IF ALT RELIBILITY IS LOST
1931                           ;****************************************************************************
1932 T 063A F802               ABORTR:  LDI     $02                 ; ABORTR FLAG
1933 T 063C AC                          PLO     RC                  ; SET ABORT FLAG
1934 T 063D 303F                        BR      ABORT               ; BRANCH
1935                           ;****************************************************************************
1936                           ;       ABORT PROCESSOR
1937                           ;****************************************************************************
1938 T 063F                    ABORT:           
1939        00000001                    IF      (VERSION GT VER_2)
1940                           
1941 T 063F 68C60804                    RLDI    R6,OKSLOW           ; SET SLOW OK LITE
1942 T 0643 D6                          SEP     R6                      ; CALL FUNCTION
1943                           
1944                                    ENDIF   
1945                           
1946 T 0644 68C2447F                    RLDI    R2,INPUT            ; I/O STACK
1947 T 0648 E3                          SEX     R3                      ; SET SP TO PC
1948 T 0649 61                          OUT     1                       ; I/O GROUP 30
1949 T 064A 30                          DB      $30
1950 T 064B 66                          OUT     6                       ; SCAN MODE
1951 T 064C 01                          DB      $01
1952 T 064D 65                          OUT     5                       ; REL
1953 T 064E 00                          DB      $00
1954 T 064F E2                          SEX     R2                      ; RESET SP
1955                           ;
1956 T 0650 3C50                        BN1     *                       ; WAIT
1957 T 0652 6C                          INP     4                       ; REL
1958                           ;
1959 T 0653 3C53                        BN1     *                       ; WAIT
1960 T 0655 6C                          INP     4                       ; 100FT ALT
1961                           ;
1962 T 0656 3C56                        BN1     *                       ; WAIT
1963 T 0658 6C                          INP     4                       ; 500FT ALT
1964                           ;
1965 T 0659 3C59                        BN1     *                       ; WAIT
1966 T 065B 6B                          INP     3                       ; WING
1967                           ;
1968 T 065C FFBF                        SMI     LOW(WNGREC)         ; SUBTRACK RECOVERY
1969 T 065E 3B62                        BNF     PREC                ; DF=0 WING BELOW RECOVERY
1970                           ;****************************************************************************
1971                           ;       DO NOT PUT WINGS IN RECOVERY
1972                           ;****************************************************************************
1973 T 0660 F0                          LDX                         ; GET POSITION
1974                           ;
1975 T 0661 C8                          LSKP                        ; SKIP NEXT INSTRUCTION
1976                           ;****************************************************************************
1977                           ;       PUT WINGS INTO RECOVERY
1978                           ;****************************************************************************
1979 T 0662 F8BF               PREC:    LDI     LOW(WNGREC)         ; RECOVERY
1980                           ;
1981 T 0664 52                          STR     R2                      ; PUT ON STACK
1982 T 0665 63                          OUT     3                       ; OUPUT D/A CH1
1983 T 0666 22                          DEC     R2                      ; RESET STACK
1984                           ;****************************************************************************
1985                           ;       EXIT TO COMMAND LINK ERROR ROUTINE
1986                           ;****************************************************************************
1987        00000001                    IF      (VERSION GT VER_2)
1988                           
1989 T 0667 F0                          LDX                         ; GET WING POSITION
1990 T 0668 FDBF                        SDI     WNGREC              ; CHECK ON RECOVERY POSITION
1991 T 066A C20700                      LBZ     LINK                ; BRANCH IF AT RECOVERY
1992 T 066D C0081C             EXIT:    LBR     CMWAIT              ; BRANCH IF NOT AT RECOVERY
1993                           
1998                                    ENDIF   
1999                           ;****************************************************************************
2000                           ;
2001                           ;       END OF ABORT PROCESSOR
2002                           ;
2003                           ;****************************************************************************
2004                           ;
2005                           ;       COMMON CODE AREA
2006                           ;
2007                           ;****************************************************************************
2008 T 0700                             ORG     $0700
2009                           ;****************************************************************************
2010                           ;
2011                           ;       ADDRESS FOR COMMAND JUMP
2012                           ;
2013                           ;****************************************************************************
2014 T 0700 C00018             LINK:    LBR     TMWAIT
2015                           ;****************************************************************************
2016                           ;
2017                           ; MATH SUBROUTINES
2018                           ;
2019                           ;****************************************************************************
2020                           ;
2021                           ;       UN-SIGNED RIGHT SHIFT OF RF
2022                           ;
2023                           ;       NUMBER OF SHIFTS PASSED INLINE
2024                           ;       THROUGH THE PROGRAM COUNTER
2025                           ;
2026                           ;       CALLED BY:
2027                           ;               RLDI R6,USHR
2028                           ;               SEP R6;,$SHIFTS
2029                           ;
2030                           ;       USES REGISTER RD.0
2031                           ;
2032                           ;****************************************************************************
2033 T 0703 43                 USHR:    LDA     R3                  ; GET NUMBER OF SHIFTS
2034 T 0704 AD                          PLO     RD                              ; SET COUNTER
2035                           ;
2036 T 0705 9F                 01$:     GHI     RF                  ; GET HIGH BYTE
2037 T 0706 F6                          SHR                         ; RIGHT SHIFT
2038 T 0707 BF                          PHI     RF                              ; RESET BYTE
2039                           ;
2040 T 0708 8F                          GLO     RF                              ; GET LOW BYTE
2041 T 0709 76                          SHRC                        ; RIGHT SHIFT WITH CARRY
2042 T 070A AF                          PLO     RF                              ; RESET LOW BYTE
2043                           ;
2044 T 070B 2D                          DEC     RD                              ; DECREMENT COUNTER
2045 T 070C 8D                          GLO     RD                              ; GET COUNTER
2046 T 070D 3A05                        BNZ     01$                     ; SHIFT TILL ZERO
2047                           ;
2048 T 070F D3                          SEP     R3                              ; RESET PROGRAM COUNTER
2049                           ;****************************************************************************
2050                           ;
2051                           ;       ARITHMETIC RIGHT SHIFT OF RF
2052                           ;
2053                           ;       NUMBER OF SHIFTS PASSED INLINE
2054                           ;       THROUGH THE PROGRAM COUNTER
2055                           ;
2056                           ;       CALLED BY:
2057                           ;               RLDI R6,ASHR
2058                           ;               SEP R6;,$SHIFTS
2059                           ;
2060                           ;       USES REGISTER RD.0
2061                           ;
2062                           ;****************************************************************************
2063 T 0710 43                 ASHR:    LDA     R3                  ; GET NUMBER OF SHIFTS
2064 T 0711 AD                          PLO     RD                              ; SET COUNTER
2065                           ;
2066 T 0712 9F                 01$:     GHI     RF                  ; GET HIGH BYTE
2067 T 0713 FE                          SHL                         ; PUT SIGH INTO DF
2068 T 0714 9F                          GHI     RF                              ; HIGH BYTE AGAIN
2069 T 0715 76                          SHRC                        ; RIGHT SHIFT WITH CARRY
2070 T 0716 BF                          PHI     RF                              ; RESET HIGH BYTE
2071                           ;
2072 T 0717 8F                          GLO     RF                              ; GET LOW BYTE
2073 T 0718 76                          SHRC                        ; RIGHT SHIFT WITH CARRY
2074 T 0719 AF                          PLO     RF                              ; RESET LOW BYTE
2075                           ;
2076 T 071A 2D                          DEC     RD                              ; DECREMENT COUNTER
2077 T 071B 8D                          GLO     RD                              ; GET COUNTER
2078 T 071C 3A12                        BNZ     01$                     ; SHIFT TILL ZERO
2079                           ;
2080 T 071E D3                          SEP     R3                              ; RESET PROGRAM COUNTER
2081                           ;****************************************************************************
2082                           ;
2083                           ;       ARITHMETIC RIGHT SHIFT OF R0,R1
2084                           ;
2085                           ;       NUMBER OF SHIFTS PASSED IN RD.0
2086                           ;
2087                           ;       CALLED BY:
2088                           ;               RLDI RD,NUMSFT
2089                           ;               LDN RD
2090                           ;               PLO RD
2091                           ;               RLDI R6,SCALE
2092                           ;               SEP R6
2093                           ;
2094                           ;       USES REGISTER RD.0
2095                           ;
2096                           ;****************************************************************************
2097 T 071F 8D                 SCALE:   GLO     RD                  ; GET NUMBER SHIFTS
2098 T 0720 3234                        BZ      02$                     ; EXIT IF ZERO
2099                           ;****************************************************************************
2100 T 0722 90                 01$:     GHI     R0                  ; GET MSB
2101 T 0723 FE                          SHL                         ; PUT SIGN IN DF
2102 T 0724 90                          GHI     R0                              ; GET MSB AGAIN
2103 T 0725 76                          SHRC                        ; RIGHT SHIFT WITH DF
2104 T 0726 B0                          PHI     R0                              ; RESET MSB
2105                           ;
2106 T 0727 80                          GLO     R0
2107 T 0728 76                          SHRC    
2108 T 0729 A0                          PLO     R0
2109                           ;
2110 T 072A 91                          GHI     R1
2111 T 072B 76                          SHRC    
2112 T 072C B1                          PHI     R1
2113                           ;
2114 T 072D 81                          GLO     R1                              ; GET LSB
2115 T 072E 76                          SHRC                        ; RIGHT SHIFT WITH DF
2116 T 072F A1                          PLO     R1                              ; RESET LSB
2117                           ;
2118 T 0730 2D                          DEC     RD                              ; DECREMENT COUNTER
2119 T 0731 8D                          GLO     RD                              ; GET COUNTER
2120 T 0732 3A22                        BNZ     01$                     ; SHIFT TILL ZERO
2121                           ;
2122 T 0734 D3                 02$:     SEP     R3
2123                           ;****************************************************************************
2124                           ;
2125                           ;       ADDITION ROUTINE
2126                           ;       32 BIT 2'S COMPLEMENT ADDITION
2127                           ;       R0,R1 = R0,R1 +RE,RF
2128                           ;
2129                           ;       CALLED BY :
2130                           ;
2131                           ;               RLDI R6,ADDER
2132                           ;               SEX R2
2133                           ;               SEP R6
2134                           ;
2135                           ;****************************************************************************
2136 T 0735 81                 ADDER:   GLO     R1                  ; GET LSB
2137 T 0736 52                          STR     R2                              ; PUT ON STACK
2138 T 0737 8F                          GLO     RF                              ; GET LOW BYTE
2139 T 0738 F4                          ADD                         ; ADD LOW BYTES
2140 T 0739 A1                          PLO     R1                              ; RESET LSB
2141                           ;
2142 T 073A 91                          GHI     R1
2143 T 073B 52                          STR     R2
2144 T 073C 9F                          GHI     RF
2145 T 073D 74                          ADC     
2146 T 073E B1                          PHI     R1
2147                           ;
2148 T 073F 80                          GLO     R0
2149 T 0740 52                          STR     R2
2150 T 0741 8E                          GLO     RE
2151 T 0742 74                          ADC     
2152 T 0743 A0                          PLO     R0
2153                           ;
2154 T 0744 90                          GHI     R0                              ; GET MSB
2155 T 0745 52                          STR     R2                              ; PUT ON STACK
2156 T 0746 9E                          GHI     RE                              ; GET HIGH BYTE
2157 T 0747 74                          ADC                         ; ADD BYTES WITH CARRY
2158 T 0748 B0                          PHI     R0                              ; RESET MSB
2159                           ;
2160 T 0749 D3                          SEP     R3                              ; RESET PROGRAM COUNTER
2161                           ;****************************************************************************
2162                           ;
2163                           ;       16 BIT SIGNED MULT ROUTINE
2164                           ;
2165                           ;       RF * M(RD) = RE (HIGH) AND RF (LOW)
2166                           ;
2167                           ;****************************************************************************
2168 T 074A 9F                 MULT:    GHI     RF
2169 T 074B F3                          XOR     
2170 T 074C FA80                        ANI     $80
2171 T 074E BC                          PHI     RC
2172 T 074F F810                        LDI     $10
2173 T 0751 AC                          PLO     RC
2174 T 0752 F800                        LDI     $00
2175 T 0754 BE                          PHI     RE
2176 T 0755 AE                          PLO     RE
2177                           ;****************************************************************************
2178 T 0756 2C                 MPL:     DEC     RC
2179 T 0757 9F                          GHI     RF
2180 T 0758 F6                          SHR     
2181 T 0759 BF                          PHI     RF
2182 T 075A 8F                          GLO     RF
2183 T 075B 76                          SHRC    
2184 T 075C AF                          PLO     RF
2185 T 075D 9E                          GHI     RE
2186 T 075E 3B6C                        BNF     MPB
2187 T 0760 1D                          INC     RD
2188 T 0761 8C                          GLO     RC
2189 T 0762 3A6F                        BNZ     MPA
2190 T 0764 8E                          GLO     RE
2191 T 0765 F7                          SM      
2192 T 0766 AE                          PLO     RE
2193 T 0767 2D                          DEC     RD
2194 T 0768 9E                          GHI     RE
2195 T 0769 77                          SMB     
2196 T 076A BE                          PHI     RE
2197 T 076B 9C                          GHI     RC
2198                           ;****************************************************************************
2199 T 076C FE                 MPB:     SHL     
2200 T 076D 3079                        BR      MPS+$03
2201 T 076F 8E                 MPA:     GLO     RE
2202 T 0770 F4                          ADD     
2203 T 0771 AE                          PLO     RE
2204 T 0772 2D                          DEC     RD
2205 T 0773 9E                          GHI     RE
2206 T 0774 74                          ADC     
2207 T 0775 BE                          PHI     RE
2208                           ;****************************************************************************
2209 T 0776 CF                 MPS:     LSDF    
2210 T 0777 F0                          LDX     
2211 T 0778 FE                          SHL     
2212 T 0779 9E                 MSP3:    GHI     RE
2213 T 077A 76                          SHRC    
2214 T 077B BE                          PHI     RE
2215 T 077C 8E                          GLO     RE
2216 T 077D 76                          SHRC    
2217 T 077E AE                          PLO     RE
2218 T 077F 3B85                        BNF     MT
2219 T 0781 9F                          GHI     RF
2220 T 0782 F980                        ORI     $80
2221 T 0784 BF                          PHI     RF
2222                           ;****************************************************************************
2223 T 0785 8C                 MT:      GLO     RC
2224 T 0786 3A56                        BNZ     MPL
2225                           ;****************************************************************************
2226 T 0788 9E                 MPX:     GHI     RE
2227 T 0789 FE                          SHL     
2228 T 078A 3B90                        BNF     MEXIT
2229 T 078C 3A90                        BNZ     MEXIT
2230 T 078E F6                          SHR     
2231 T 078F BE                          PHI     RE
2232                           ;****************************************************************************
2233 T 0790 D3                 MEXIT:   SEP     R3
2234                           ;****************************************************************************
2235                           ;
2236                           ;       DIVISION ROUTINE
2237                           ;
2238                           ;       RF = RE,RF/M(RD)
2239                           ;
2240                           ;****************************************************************************
2241 T 0791 9E                 DIVQ:    GHI     RE                  ;
2242 T 0792 FE                          SHL                         ;
2243 T 0793 F890                        LDI     $90                     ;
2244 T 0795 C7                          LSNF                        ;
2245 T 0796 F850                        LDI     $50                     ;
2246 T 0798 AC                          PLO     RC                              ;
2247 T 0799 8E                 DVL:     GLO     RE                  ;
2248 T 079A FE                          SHL                         ;
2249 T 079B AE                          PLO     RE                              ;
2250 T 079C 9E                          GHI     RE                              ;
2251 T 079D 7E                          SHLC                        ;
2252 T 079E BE                          PHI     RE                              ;
2253                           ;
2254 T 079F 8F                          GLO     RF                              ;
2255 T 07A0 FE                          SHL                         ;
2256 T 07A1 AF                          PLO     RF                              ;
2257 T 07A2 9F                          GHI     RF                              ;
2258 T 07A3 7E                          SHLC                        ;
2259 T 07A4 BF                          PHI     RF                              ;
2260                           ;
2261 T 07A5 3BA8                        BNF     DSEX
2262                           ;
2263 T 07A7 1E                          INC     RE                              ;
2264                           ;
2265 T 07A8 ED                 DSEX:    SEX     RD                  ;
2266 T 07A9 8C                          GLO     RC                              ;
2267 T 07AA F3                          XOR                         ;
2268 T 07AB FE                          SHL                         ;
2269 T 07AC 1D                          INC     RD                              ;
2270 T 07AD 8E                          GLO     RE                              ;
2271 T 07AE 3BB7                        BNF     DSA                     ;
2272 T 07B0 F7                          SM                          ;
2273 T 07B1 AE                          PLO     RE                              ;
2274 T 07B2 2D                          DEC     RD                              ;
2275 T 07B3 9E                          GHI     RE                              ;
2276 T 07B4 77                          SMB                         ;
2277 T 07B5 30BC                        BR      DSM                     ;
2278                           ;
2279 T 07B7 F4                 DSA:     ADD                         ;
2280 T 07B8 AE                          PLO     RE                              ;
2281 T 07B9 2D                          DEC     RD                              ;
2282 T 07BA 9E                          GHI     RE                              ;
2283 T 07BB 74                          ADC                         ;
2284 T 07BC BE                 DSM:     PHI     RE                  ;
2285 T 07BD 2C                          DEC     RC                              ;
2286 T 07BE 8C                          GLO     RC                              ;
2287 T 07BF FA7F                        ANI     $7F                     ;
2288 T 07C1 3BC6                        BNF     DCR
2289                           ;
2290 T 07C3 1F                          INC     RF                              ;
2291 T 07C4 F980                        ORI     $80                     ;
2292 T 07C6 AC                 DCR:     PLO     RC                  ;
2293 T 07C7 FA3F                        ANI     $3F                     ;
2294 T 07C9 3A99                        BNZ     DVL                     ;
2295 T 07CB 33E2                        BDF     DVR                     ;
2296 T 07CD 38                          SKP                         ;
2297                           ;
2298 T 07CE 1F                 DVC:     INC     RF                  ;
2299 T 07CF F3                          XOR                         ;
2300 T 07D0 FE                          SHL                         ;
2301 T 07D1 1D                          INC     RD                              ;
2302 T 07D2 8E                          GLO     RE                              ;
2303 T 07D3 33DC                        BDF     DVM                     ;
2304 T 07D5 F4                          ADD                         ;
2305 T 07D6 AE                          PLO     RE                              ;
2306 T 07D7 2D                          DEC     RD                              ;
2307 T 07D8 9E                          GHI     RE                              ;
2308 T 07D9 74                          ADC                         ;
2309 T 07DA 30E1                        BR      DVR-$01
2310                           ;
2311 T 07DC F7                 DVM:     SM                          ;
2312 T 07DD AE                          PLO     RE                              ;
2313 T 07DE 2D                          DEC     RD                              ;
2314 T 07DF 9E                          GHI     RE                                  ;
2315 T 07E0 77                          SMB                         ;
2316 T 07E1 BE                          PHI     RE                              ;
2317                           ;
2318 T 07E2 9E                 DVR:     GHI     RE                  ;
2319 T 07E3 3AE8                        BNZ     DCR1                    ;
2320 T 07E5 8E                          GLO     RE                              ;
2321 T 07E6 32F3                        BZ      DVN                     ;
2322 T 07E8 8C                 DCR1:    GLO     RC                  ;
2323 T 07E9 FE                          SHL                         ;
2324 T 07EA FE                          SHL                         ;
2325 T 07EB 9E                          GHI     RE                              ;
2326 T 07EC CF                          LSDF                        ;
2327 T 07ED FB80                        XRI     $80                     ;
2328 T 07EF FC80                        ADI     $80                     ;
2329 T 07F1 3BCE                        BNF     DVC                     ;
2330                           ;
2331 T 07F3 F0                 DVN:     LDX                         ;
2332 T 07F4 FE                          SHL                         ;
2333 T 07F5 3BFF                        BNF     DVX                     ;
2334 T 07F7 AF                          PLO     RF                              ;
2335 T 07F8 9F                          GHI     RF                              ;
2336 T 07F9 FBFF                        XRI     $FF                     ;
2337 T 07FB BF                          PHI     RF                              ;
2338 T 07FC 1F                          INC     RF                              ;
2339                           ;
2340 T 07FD FC00                        ADI     $00                     ; CLEAR DF
2341                           ;
2342 T 07FF D3                 DVX:     SEP     R3                              ;RETURN
2343                           ;****************************************************************************
2344                           ;
2345                           ;       END OF 2K EPROM $0000-$07FF
2346                           ;
2347                           ;****************************************************************************
2348                           ;
2349                           ; START OF ADDRESS SPACE IN 2ND EPROM
2350                           ;
2351                           ;****************************************************************************
2352 T 0800                             ORG     $0800
2353                           ;****************************************************************************
2354                           ;
2355                           ;
2356                           ; ALTERNATE PROGRAM
2357                           ;
2358                           ;
2359                           ;****************************************************************************
2360 T 0800 C4                 TLXALT:  NOP                         ; NO OPERATION
2361                           
2362        00000000                    IF      ((VERSION GT VER_2) AND (VERSION LT VER_5))
2366                                    ELSE    
2367                           
2368 T 0801 C00C00                      LBR     ALTCON                  ; CALL ALTERNATE PROGRAM WITH PROGRAMMABLE
2369                                                                ; GAINS
2370                           
2371                                    ENDIF   
2372                           ;****************************************************************************
2373                           ;
2374                           ;       SETUP COUNTER MODE 2
2375                           ;
2376                           ;       1805 DOWN COUNTER WITH DOWN COUNT ON
2377                           ;       EACH TRANSITION OF EF2 (DATA VALID)
2378                           ;       THE INITIAL COUNTER VALUE IS SET TO
2379                           ;       UNDERFLOW EVERY 64 DEC COUNTS
2380                           ;       (0.25 SECONDS) AND TO FLIP/FLOP THE
2381                           ;       Q TOGGLE.
2382                           ;       THE COUNTER VALUE IS COMPUTED BY:
2383                           ;
2384                           ;       2048 BITS/SEC FROM REMTRON DECODER
2385                           ;       256 FRAMES/SEC FROM DECODER
2386                           ;       0.25 SEC / 256 SEC/FRAME = 64
2387                           ;
2388                           ;****************************************************************************
2389        00000001                    IF      (VERSION GT VER_2)
2390                           
2391 T 0804 6800               OKSLOW:  STPC                        ; STOP COUNTER
2392 T 0806 F840                        LDI     OKLITE                  ; 64 COUNTS
2393 T 0808 6806                        LDC                         ; LOAD COUNTER
2394 T 080A 6809                        ETQ                         ; ENABLE Q
2395 T 080C 6803                        SCM2                        ; COUNTER MODE 2
2396 T 080E D3                          SEP     R3                              ; RETURN
2397                           
2398                                    ENDIF   
2399                           ;****************************************************************************
2400                           ;
2401                           ;       SETUP COUNTER MODE 2
2402                           ;
2403                           ;       1805 DOWN COUNTER WITH DOWN COUNT ON
2404                           ;       EACH TRANSITION OF EF2 (DATA VALID)
2405                           ;       THE INITIAL COUNTER VALUE IS SET TO
2406                           ;       UNDERFLOW EVERY 64 DEC COUNTS
2407                           ;       (0.25 SECONDS) AND TO FLIP/FLOP THE
2408                           ;       Q TOGGLE.
2409                           ;       THE COUNTER VALUE IS COMPUTED BY:
2410                           ;
2411                           ;       2048 BITS/SEC FROM REMTRON DECODER
2412                           ;       256 FRAMES/SEC FROM DECODER
2413                           ;       0.25 SEC / 256 SEC/FRAME = 64
2414                           ;
2415                           ;****************************************************************************
2416        00000001                    IF      (VERSION GT VER_2)
2417                           
2418 T 080F 6800               OKFAST:  STPC                        ; STOP COUNTER
2419 T 0811 F840                        LDI     OKLITE                  ; 64 COUNTS
2420 T 0813 F6                          SHR                         ; 32 COUNTS
2421 T 0814 F6                          SHR                         ; 16 COUNTS
2422 T 0815 6806                        LDC                         ; LOAD COUNTER
2423 T 0817 6809                        ETQ                         ; ENABLE Q
2424 T 0819 6803                        SCM2                        ; COUNTER MODE 2
2425 T 081B D3                          SEP     R3                              ; RETURN
2426                           
2427                                    ENDIF   
2428                           ;****************************************************************************
2429                           ;
2430                           ;       SETUP PIO PORTS FOR COMMAND/TM LINK
2431                           ;
2432                           ;       I/O GROUP NUMBER 8
2433                           ;       CHANNEL A INPUT (DATA WORD)
2434                           ;       CHANNEL B BIT PROGRAMABLE
2435                           ;       LOW NIBBLE INPUT (ADDRESS)
2436                           ;       HIGH NIBBLE OUTPUT (STATUS)
2437                           ;
2438                           ;****************************************************************************
2439        00000001                    IF      (VERSION GT VER_2)
2440                           
2441 T 081C E3                 CMWAIT:  SEX     R3                  ; SET PC TO SP
2442 T 081D 61                          OUT     1                               ; I/O GROUP 8
2443 T 081E 08                          DB      $08
2444 T 081F 62                          OUT     2
2445 T 0820 0F                          DB      $0F
2446 T 0821 62                          OUT     2
2447 T 0822 F7                          DB      $F7
2448 T 0823 62                          OUT     2
2449 T 0824 F0                          DB      $F0
2450                           ;
2451 T 0825 68C2447F                    RLDI    R2,INPUT                ; INPUT STACK
2452 T 0829 E2                          SEX     R2                              ; SET SP
2453 T 082A F810                        LDI     RECLIT                  ; RECOVERY LIGHT
2454 T 082C AC                          PLO     RC                              ; STORE WORD
2455                           ;****************************************************************************
2456 T 082D 352D               01$:     B2      01$                 ; WAIT FOR DATA VALID
2457                           ;****************************************************************************
2458 T 082F 6E                          INP     6                               ; INPUT ADDRESS
2459 T 0830 60                          IRX                         ; INCREMENT SP
2460 T 0831 6C                          INP     4                               ; INPUT ADDRESS
2461 T 0832 22                          DEC     R2                              ; RESET SP
2462 T 0833 F0                          LDX                         ; GET ADDRESS
2463 T 0834 FA0F                        ANI     $0F                     ; MASK BITS
2464                           ;
2465 T 0836 FF09                        SMI     $09                     ; CHANNEL NINE
2466 T 0838 3A2D                        BNZ     01$                     ; IF NOT NEXT INPUT
2467                           ;****************************************************************************
2468                           ;       CHECK REC/FLY BIT FOR FLY
2469                           ;****************************************************************************
2470 T 083A 60                          IRX                         ; INCREMENT TO DATA
2471 T 083B F0                          LDX                         ; GET DATA
2472 T 083C BC                          PHI     RC                              ; STORE WORD
2473 T 083D 22                          DEC     R2                              ; RESET SP
2474                           ;
2475 T 083E 8C                          GLO     RC                              ; GET LIGHT
2476 T 083F 52                          STR     R2                              ; STACK IT
2477 T 0840 FBFF                        XRI     $FF                     ; INVERT BITS
2478 T 0842 FA10                        ANI     RECLIT                  ; ONLY REC LIGHT
2479 T 0844 AC                          PLO     RC                              ; RESET LIGHT
2480 T 0845 66                          OUT     6                               ; SEND STATUS
2481 T 0846 22                          DEC     R2                              ; RESET STACK
2482                           ;
2483 T 0847 68CF3FFF                    RLDI    RF,$3FFF                ; COUNTER DELAY
2484 T 084B C4                 02$:     NOP                         ; NO OPERATION
2485 T 084C 682F084B                    DBNZ    RF,02$                  ; DELAY LOOP
2486                           ;
2487 T 0850 9C                          GHI     RC                              ; GET WORD
2488 T 0851 FA01                        ANI     RECBIT                  ; MASK REC BIT
2489 T 0853 FB01                        XRI     $01                             ; INVERT REC BIT
2490 T 0855 322D                        BZ      01$                             ; IF NOT REC, WAIT
2491                           ;****************************************************************************
2492 T 0857 C00700                      LBR     LINK                    ; RETURN TO COMMAND LINK
2493                           
2494                                    ENDIF   
2495                           ;****************************************************************************
2496        00000001                    IF      (VERSION GT VER_3)
2497                           
2498 T 0900                             ORG     $0900
2499                           
2500                                    ENDIF   
2501                           ;****************************************************************************
2502                           ;
2503                           ;       SET FIXED GAINS (VERSION 2 GAINS)
2504                           ;
2505                           ;****************************************************************************
2506        00000001                    IF      (VERSION GT VER_2)
2507                           
2508 T 0900 68CD477F           GAINEW:  RLDI    RD,WFLAG            ; WING POSITION
2509 T 0904 ED                          SEX     RD                              ; POINT STACK AT WING POSITION
2510 T 0905 0D                          LDN     RD                              ; GET WING POSITION
2511 T 0906 FF73                        SMI     WNGRL                   ; SUB -4.5 DEGREES
2512 T 0908 3B56                        BNF     01$                     ; DON'T ENGAGE NEW GAINS IF LESS THAN
2513 T 090A 0D                          LDN     RD                              ; GET WING POSITION
2514 T 090B FF8B                        SMI     WNGRH                   ; SUB -3.5 DEGREES
2515 T 090D 3356                        BDF     01$                     ; DON'T ENGAGE NEW GAINS IF GREATER THAN
2516                           ;****************************************************************************
2517 T 090F 68CD47FF                    RLDI    RD,PFLAG                ; PRESET FLAG
2518 T 0913 F8FF                        LDI     $FF                     ; SET FLAG
2519 T 0915 5D                          STR     RD                              ; STORE FLAG
2520                           
2521 T 0916 ED                          SEX     RD                              ; SET SP TO RD
2522                           ;
2523 T 0917 68CD451F                    RLDI    RD,EGAIN
2524 T 091B F866                        LDI     $66                     ; 2.000 VOLTS
2525 T 091D 73                          STXD    
2526 T 091E F800                        LDI     $00
2527 T 0920 5D                          STR     RD
2528                           ;
2529 T 0921 68CD452F                    RLDI    RD,RGAIN
2530 T 0925 F84C                        LDI     $4C                     ; 1.500 VOLTS
2531 T 0927 73                          STXD    
2532 T 0928 F800                        LDI     $00
2533 T 092A 5D                          STR     RD
2534                           ;
2535 T 092B 68CD453F                    RLDI    RD,IGAIN
2536 T 092F F833                        LDI     $33                     ; 1.000 VOLTS
2537 T 0931 73                          STXD    
2538 T 0932 F800                        LDI     $00
2539 T 0934 5D                          STR     RD
2540                           ;
2541 T 0935 68CD454F                    RLDI    RD,SGAIN
2542 T 0939 F850                        LDI     $50                     ; 1.568 VOLTS
2543 T 093B 73                          STXD    
2544 T 093C F800                        LDI     $00
2545 T 093E 5D                          STR     RD
2546                           ;
2547 T 093F 68CD455F                    RLDI    RD,RESET
2548                           
2549        00000001                    IF      (VERSION GT 3)
2550                           
2551 T 0943 F866                        LDI     $66                     ; 2.00 VOLTS
2552                           
2557                                    ENDIF   
2558                           
2559 T 0945 73                          STXD    
2560 T 0946 F800                        LDI     $00
2561 T 0948 5D                          STR     RD
2562                           
2563 T 0949 68CC4517                    RLDI    RC,EGAIN2               ; POINT TO GAIN 2
2564 T 094D 68CD451F                    RLDI    RD,EGAIN                ; POINT TO GAIN
2565 T 0951 0C                          LDN     RC                              ; GET GAIN 2
2566 T 0952 73                          STXD                        ; STORE AND DECREMENT STACK
2567 T 0953 F800                        LDI     $00                     ; ZERO HIGH BYTE
2568 T 0955 5D                          STR     RD                              ; STACK IT
2569                           
2570 T 0956 D3                 01$:     SEP     R3                              ; RETURN
2571                           
2572                                    ENDIF   
2573                           ;****************************************************************************
2574                           ;
2575                           ;       SET FIXED GAINS  (VERSION 1 GAINS)
2576                           ;
2577                           ;****************************************************************************
2578        00000001                    IF      (VERSION GT VER_2)
2579                           
2580 T 0957 ED                 GAINLD:  SEX     RD                  ; SET SP TO RD
2581                           ;
2582 T 0958 68CD451F                    RLDI    RD,EGAIN
2583 T 095C F833                        LDI     $33                     ; 1.000 VOLTS
2584 T 095E 73                          STXD    
2585 T 095F F800                        LDI     $00
2586 T 0961 5D                          STR     RD
2587                           ;
2588 T 0962 68CD452F                    RLDI    RD,RGAIN
2589 T 0966 F84C                        LDI     $4C                     ; 1.500 VOLTS
2590 T 0968 73                          STXD    
2591 T 0969 F800                        LDI     $00
2592 T 096B 5D                          STR     RD
2593                           ;
2594 T 096C 68CD453F                    RLDI    RD,IGAIN
2595 T 0970 F833                        LDI     $33                     ; 1.000
2596 T 0972 73                          STXD    
2597 T 0973 F800                        LDI     $00
2598 T 0975 5D                          STR     RD
2599                           ;
2600 T 0976 68CD454F                    RLDI    RD,SGAIN
2601 T 097A F850                        LDI     $50                     ; 1.568 VOLTS
2602 T 097C 73                          STXD    
2603 T 097D F800                        LDI     $00
2604 T 097F 5D                          STR     RD
2605                           ;
2606 T 0980 68CD454F                    RLDI    RD,SGAIN
2607 T 0984 F850                        LDI     $50                     ; 1.568 VOLTS
2608 T 0986 73                          STXD    
2609 T 0987 F800                        LDI     $00
2610 T 0989 5D                          STR     RD
2611                           ;
2612 T 098A 68CD455F                    RLDI    RD,RESET
2613                           
2614        00000001                    IF      (VERSION GT 3)
2615                           
2616 T 098E F866                        LDI     $66                     ; 2.00 VOLTS
2617                           
2622                                    ENDIF   
2623                           
2624 T 0990 73                          STXD    
2625 T 0991 F800                        LDI     $00
2626 T 0993 5D                          STR     RD
2627                           
2628 T 0994 68CD4517                    RLDI    RD,EGAIN2
2629 T 0998 F866                        LDI     $66                     ; 2.000 VOLTS
2630 T 099A 73                          STXD    
2631 T 099B F800                        LDI     $00
2632 T 099D 5D                          STR     RD
2633                           
2634 T 099E D3                          SEP     R3                              ; RETURN
2635                           
2636                                    ENDIF   
2637                           ;****************************************************************************
2638                           ;       RESET TO OLD GAINS IF TOO HIGH
2639                           ;****************************************************************************
2640        00000001                    IF      (VERSION GT VER_3)
2641                           
2642 T 099F                    GAINRT:          
2643 T 099F 68CD47FF                    RLDI    RD,PFLAG            ; PRESET FLAG
2644 T 09A3 0D                          LDN     RD                  ; LOAD FLAG
2645 T 09A4 32B3                        BZ      01$                 ; IF FLAG RESET SKIP RESETTING SLOW OK
2646                           
2647 T 09A6 F800                        LDI     $00                 ; RESET FLAG
2648 T 09A8 5D                          STR     RD                  ; STORE FLAG
2649                           
2650 T 09A9 68C60957                    RLDI    R6,GAINLD           ; SET OLD GAIN FUNCTION
2651 T 09AD D6                          SEP     R6                  ; CALL FUNCTION
2652                           
2653 T 09AE 68C60804                    RLDI    R6,OKSLOW           ; SET STANDARD OK LITE
2654 T 09B2 D6                          SEP     R6                  ; CALL FUNCTION
2655                           
2656 T 09B3 C0050F             01$:     LBR     OUT                 ; RETURN TO MAIN CODE
2657                           
2658                                    ENDIF   
2659                           ;****************************************************************************
2660                           ;       PROGRAMABLE CONTROLLER PATCH AREA
2661                           ;****************************************************************************
2662        00000001                    IF      (VERSION GT VER_2)
2663                           
2664 T 09B6 ED                 PRGPAT:  SEX     RD                  ; SET SP TO RD
2665                           
2666 T 09B7 68CC454F                    RLDI    RC,SGAIN                ; POINT TO SCALE FACTOR
2667 T 09BB 68CD4517                    RLDI    RD,EGAIN2               ; POINT TO GAIN 2
2668 T 09BF 0C                          LDN     RC                              ; GET SCALE
2669 T 09C0 73                          STXD                        ; STORE AND DECREMENT STACK
2670 T 09C1 F800                        LDI     $00                     ; ZERO HIGH BYTE
2671 T 09C3 5D                          STR     RD                              ; STACK IT
2672                           
2673 T 09C4 68CD454F                    RLDI    RD,SGAIN
2674 T 09C8 F850                        LDI     $50                     ; 1.568 VOLTS
2675 T 09CA 73                          STXD    
2676 T 09CB F800                        LDI     $00
2677 T 09CD 5D                          STR     RD
2678                           
2679 T 09CE C00400                      LBR     TLXACC                              ; RUN CONTROLLER
2680                           
2681                                    ENDIF   
2682                           ;****************************************************************************
2683        00000001                    IF      (VERSION GT VER_3)
2684                           
2685 T 0A00                             ORG     $0A00
2686                           
2687                                    ENDIF   
2688                           ;****************************************************************************
2689                           ;       TEST FOR ACTIVE DECODER
2690                           ;       IF DECODER NOT ACTIVE, OR CPU HAS LOCKED UP
2691                           ;       THE OK LITE WILL NOT BLINK
2692                           ;****************************************************************************
2693        00000001                    IF      (VERSION GT VER_2)
2694                           
2695 T 0A00                    RTD1:            
2696                           
2697                                    ENDIF   
2698                           
2699        00000001                    IF      (VERSION GT VER_3)
2700                           
2701 T 0A00 68CD473F                    RLDI    RD,COMCHK           ; POINT TO COMMAND WORD LAST
2702 T 0A04 F801                        LDI     RECBIT              ; LOAD RECOVERY BIT
2703 T 0A06 5D                          STR     RD                         ; STORE AS LAST COMMAND
2704 T 0A07 68CD473D                    RLDI    RD,COMCNT           ; POINT TO COMMAND COUNT
2705 T 0A0B F800                        LDI     $00                        ; ZERO COUNT
2706 T 0A0D 5D                          STR     RD                         ; SET COUNTER
2707                           
2708                                    ENDIF   
2709                           
2710        00000001                    IF      (VERSION GT VER_2)
2711                           
2712 T 0A0E 68CC00FF                    RLDI    RC,$FF              ; NUMBER COUNTS
2713 T 0A12 3512               01$:     B2      01$                             ; WAIT FOR DATA VALID
2714 T 0A14 682C0A12                    DBNZ    RC,01$              ; LOOP FOR ALL COUNTS ( APPROXIMATELY 1 SECOND )
2715 T 0A18 C00009                      LBR     OKSET                   ; RETURN TO MAIN CODE STREAM
2716                           
2717                                    ENDIF   
2718                           ;****************************************************************************
2719                           ;       COMMAND MODE PATCH AREA
2720                           ;****************************************************************************
2721        00000001                    IF      (VERSION GT VER_3)
2722                           
2723 T 0A1B                    CMDPAT:          
2724 T 0A1B 68CD473F                    RLDI    RD,COMCHK           ; POINT TO COMMAND WORD LAST
2725 T 0A1F ED                          SEX     RD                              ; MAKE RD STACK POINTER
2726 T 0A20 9C                          GHI     RC                              ; GET CURRENT COMMAND
2727 T 0A21 F7                          SM                          ; SUBTRACK LAST COMMAND FROM CURRENT
2728 T 0A22 3230                        BZ      01$                             ; IF COMMANDS SAME CHECK COUNT
2729                           
2730 T 0A24 9C                          GHI     RC                              ; GET CURRENT COMMAND
2731 T 0A25 5D                          STR     RD                              ; UPDATE LAST COMMAND
2732 T 0A26 68CD473D                    RLDI    RD,COMCNT               ; POINT TO COMMAND COUNT
2733 T 0A2A F800                        LDI     $00                             ; ZERO COUNT
2734 T 0A2C 5D                          STR     RD                              ; SET COUNTER
2735 T 0A2D CA0106                      LBNZ    PULLIT              ; RECOVERY MODE STAYS IN EFFECT
2736                           
2737 T 0A30 68CD473D           01$:     RLDI    RD,COMCNT           ; GET COMMAND COUNT
2738 T 0A34 0D                          LDN     RD                              ; LOAD COUNT
2739 T 0A35 FC01                        ADI     $01                             ; ADD 1 TO COUNT
2740 T 0A37 5D                          STR     RD                              ; UPDATE COUNT
2741 T 0A38 FF03                        SMI     $03                             ; FOUR VALID COMMANDS
2742 T 0A3A CA0106                      LBNZ    PULLIT              ; RECOVERY MODE STAYS IN EFFECT
2743                           
2744                                    ENDIF   
2745                           
2746        00000001                    IF      (VERSION GT VER_4)
2747                           
2748 T 0A3D F802                        LDI     $02                     ; SET COUNT TO ALLOW MAUNAL
2749 T 0A3F 5D                          STR     RD                      ; UPDATE COUNT
2750                           
2751                                    ENDIF   
2752                           
2753        00000001                    IF      (VERSION GT VER_3)
2754                           
2755 T 0A40 C000D5                      LBR     ECHO                ; EXECUTE COMMAND
2756                           
2757                                    ENDIF   
2758                           ;****************************************************************************
2759                           ;       HALT MODE PATCH AREA
2760                           ;****************************************************************************
2761        00000001                    IF      (VERSION GT VER_3)
2762                           
2763 T 0A43                    HALTPAT:         
2764 T 0A43 68CF0167                    RLDI    RF,$0167            ; DELAY COUNTER
2765                           
2766 T 0A47 3E5E               01$:     BN3     02$
2767 T 0A49 3E5E                        BN3     02$
2768 T 0A4B 3E5E                        BN3     02$
2769 T 0A4D 3E5E                        BN3     02$
2770                           
2771 T 0A4F 3E5E                        BN3     02$
2772 T 0A51 3E5E                        BN3     02$
2773 T 0A53 3E5E                        BN3     02$
2774 T 0A55 3E5E                        BN3     02$
2775                           
2776 T 0A57 682F0A47                    DBNZ    RF,01$              ; DECREMENT DELAY COUNT
2777 T 0A5B C0043C                      LBR     TLXFLY              ; CONTINUE WITH FLY MODE
2778                           ;****************************************************************************
2779                           ;       JUMP TO COMMAND LINK
2780                           ;****************************************************************************
2781 T 0A5E C00630             02$:     LBR     ABORTP                  ; ABORT PROCESSOR
2782                           
2783                                    ENDIF   
2784                           ;****************************************************************************
2785                           ;
2786                           ;       END OF PATCH AREA
2787                           ;
2788                           ;****************************************************************************
2789        00000001                    IF      (VERSION GT VER_3)
2790 T 0B00                             ORG     $0B00
2791                                    ENDIF   
2792                           ;****************************************************************************
2793                           ;
2794                           ;       TEST ROUTINE
2795                           ;
2796                           ;       IF PRESET ALTITUDE SET LESS THAN
2797                           ;       900 FEET RUN ALTERNATE CONTROLLER
2798                           ;       PROGRAM. OTHERWISW USE PRESET FOR
2799                           ;       TEST CODE.
2800                           ;
2801                           ;****************************************************************************
2802 T 0B00 68CD4637           TEST:    RLDI    RD,PREHUN
2803 T 0B04 0D                          LDN     RD
2804 T 0B05 FF09                        SMI     $09
2805 T 0B07 CA0C00                      LBNZ    ALTCON
2806                           ;****************************************************************************
2807                           ;
2808                           ; READ TENS DIGIT FOR TEST CODE
2809                           ;
2810                           ;****************************************************************************
2811 T 0B0A 68CD463B                    RLDI    RD,PRETEN
2812 T 0B0E 0D                          LDN     RD
2813 T 0B0F C20B3D                      LBZ     TEST0
2814                           ;
2815 T 0B12 FF01                        SMI     $01
2816 T 0B14 C20B40                      LBZ     TEST1
2817                           ;
2818 T 0B17 FF01                        SMI     $01
2819 T 0B19 C20B43                      LBZ     TEST2
2820                           ;
2821 T 0B1C FF01                        SMI     $01
2822 T 0B1E C20B46                      LBZ     TEST3
2823                           ;
2824 T 0B21 FF01                        SMI     $01
2825 T 0B23 C20B49                      LBZ     TEST4
2826                           ;
2827 T 0B26 FF01                        SMI     $01
2828 T 0B28 C20B4C                      LBZ     TEST5
2829                           ;
2830 T 0B2B FF01                        SMI     $01
2831 T 0B2D C20B4F                      LBZ     TEST6
2832                           ;
2833 T 0B30 FF01                        SMI     $01
2834 T 0B32 C20B52                      LBZ     TEST7
2835                           ;
2836 T 0B35 FF01                        SMI     $01
2837 T 0B37 C20B55                      LBZ     TEST8
2838                           ;
2839 T 0B3A C00B58                      LBR     TEST9
2840                           ;****************************************************************************
2841                           ; TEST ROUTINE JUMP TABLE
2842                           ;****************************************************************************
2843 T 0B3D C4                 TEST0:   NOP     
2844 T 0B3E C4                          NOP     
2845 T 0B3F C4                          NOP     
2846 T 0B40 C4                 TEST1:   NOP     
2847 T 0B41 C4                          NOP     
2848 T 0B42 C4                          NOP     
2849 T 0B43 C4                 TEST2:   NOP     
2850 T 0B44 C4                          NOP     
2851 T 0B45 C4                          NOP     
2852 T 0B46 C4                 TEST3:   NOP     
2853 T 0B47 C4                          NOP     
2854 T 0B48 C4                          NOP     
2855 T 0B49 C4                 TEST4:   NOP     
2856 T 0B4A C4                          NOP     
2857 T 0B4B C4                          NOP     
2858 T 0B4C C4                 TEST5:   NOP     
2859 T 0B4D C4                          NOP     
2860 T 0B4E C4                          NOP     
2861 T 0B4F C4                 TEST6:   NOP     
2862 T 0B50 C4                          NOP     
2863 T 0B51 C4                          NOP     
2864 T 0B52 C4                 TEST7:   NOP     
2865 T 0B53 C4                          NOP     
2866 T 0B54 C4                          NOP     
2867 T 0B55 C4                 TEST8:   NOP     
2868 T 0B56 C4                          NOP     
2869 T 0B57 C4                          NOP     
2870 T 0B58 C4                 TEST9:   NOP     
2871 T 0B59 C4                          NOP     
2872 T 0B5A C4                          NOP     
2873                           ;****************************************************************************
2874                           ;
2875                           ; RETURN TO MAIN COMMAND LINK LOOP
2876                           ;
2877                           ;****************************************************************************
2878 T 0B5B C4                 TESTX:   NOP     
2879 T 0B5C C4                          NOP     
2880 T 0B5D C4                          NOP     
2881                           ;
2882 T 0B5E C00051                      LBR     GRABER
2883                           ;****************************************************************************
2884                           ;
2885                           ;       STASH VERSION NUMBER
2886                           ;
2887                           ;****************************************************************************
2888        00000001                    IF      (VERSION GT 3)
2889                           
2890 T 0BF0                             ORG     $0BF0
2891                           
2892 T 0BF0 56455253494F4E              DB      'VERSION'
2893 T 0BF7 05                          DB      VERSION
2894 T 0BF8 000B035C                    DD      _DATE
2895                           
2896                                    ENDIF   
2897                           ;****************************************************************************
2898                           ;
2899                           ; ALTERNATE CONTROLLER
2900                           ;
2901                           ;****************************************************************************
2902 T 0C00                             ORG     $0C00
2903                           ;****************************************************************************
2904 T 0C00 C4                 ALTCON:  NOP                         ; NO OPERATION
2905                           
2906        00000000                    IF      (VERSION GT VER_5)
2912                                    ENDIF   
2913                           ;****************************************************************************
2914   0C01                             END     
There were: 0000 Errors

SECTIONS USED:

 Section           Relocation   Alignment  Type     Begins       Ends
 TLX               absolute                         0000         0C00


SYMBOL TABLE

SYMBOLS DEFINED:

 Symbol            Section/Type        Attribute Value             Length
 ABORT             absolute                      063F      
 ABORTL            absolute                      0635      
 ABORTP            absolute                      0630      
 ABORTR            absolute                      063A      
 ABOT              local constant                41E0      
 ABYTE             local constant                0020      
 ACC               absolute                      0130      
 ACCBIT            local constant                0000      
 ACCBNK            absolute                      0137      
 ACCEL             absolute                      054B      
 ACCLIT            local constant                0060      
 ACCOK             absolute                      0188      
 ACCZER            absolute                      0401      
 ADDER             absolute                      0735      
 ADGETC            absolute                      02FF      
 ADSET             absolute                      0468      
 ADSETC            absolute                      02E7      
 AHIGH             absolute                      0502      
 AHIGHC            absolute                      0393      
 ALT               absolute                      01B3      
 ALTBIT            local constant                0004      
 ALTBNK            absolute                      01BA      
 ALTCON            absolute                      0C00      
 ALTHIH            local constant                435F      
 ALTLIT            local constant                0040      
 ALTLOW            local constant                436F      
 ALTOK             absolute                      01E7      
 ALTREL            local constant                437F      
 ALTSFC            absolute                      02D2      
 ARATE             absolute                      0527      
 ASHFTC            absolute                      02DF      
 ASHR              absolute                      0710      
 ATOP              local constant                41FF      
 AUTO              absolute                      0494      
 AUTOC             absolute                      031D      
 AVG               absolute                      04C6      
 AVGC              absolute                      0356      
 BIAS              absolute                      048B      
 CAHFT             absolute                      044B      
 CALERC            absolute                      0372      
 CALERR            absolute                      04E2      
 CBOT              local constant                42E0      
 CBYTE             local constant                0020      
 CBYTE2            local constant                0010      
 CCEL              absolute                      058F      
 CELAVG            absolute                      0558      
 CELSFT            absolute                      0453      
 CH0               absolute                      0093      
 CH1               absolute                      009B      
 CH2               absolute                      00A1      
 CH3               absolute                      00A7      
 CH4               absolute                      00AD      
 CH5               absolute                      00B3      
 CH6               absolute                      00B9      
 CH7               absolute                      00BF      
 CH8               absolute                      00C5      
 CH9               absolute                      00CB      
 CLTSHF            absolute                      043E      
 CMDPAT            absolute                      0A1B      
 CMWAIT            absolute                      081C      
 COMCHK            local constant                473F      
 COMCNT            local constant                473D      
 COMFLG            local constant                473B      
 COMWRD            local constant                46FF      
 COUNT             local constant                43FF      
 CSHFT             absolute                      0460      
 CTOP              local constant                42FF      
 DCR               absolute                      07C6      
 DCR1              absolute                      07E8      
 DELAY1            absolute                      0047      
 DELAY2            absolute                      0144      
 DELAY3            absolute                      019F      
 DELAY4            absolute                      01C7      
 DETDEC            absolute                      01EA      
 DETDEV            absolute                      04F0      
 DIVQ              absolute                      0791      
 DOUBLE            absolute                      0574      
 DSA               absolute                      07B7      
 DSEX              absolute                      07A8      
 DSM               absolute                      07BC      
 DVC               absolute                      07CE      
 DVL               absolute                      0799      
 DVM               absolute                      07DC      
 DVN               absolute                      07F3      
 DVR               absolute                      07E2      
 DVX               absolute                      07FF      
 ECHO              absolute                      00D5      
 EGAIN             local constant                451F      
 EGAIN2            local constant                4517      
 EXIT              absolute                      066D      
 FEDPOT            local constant                434F      
 GAINER            absolute                      0155      
 GAINEW            absolute                      0900      
 GAINLD            absolute                      0957      
 GAINRT            absolute                      099F      
 GLOADS            local constant                433F      
 GRABER            absolute                      0051      
 HALT              absolute                      0439      
 HALTPAT           absolute                      0A43      
 HUNDS             absolute                      0255      
 IGAIN             local constant                453F      
 INPUT             local constant                447F      
 LIMIT             absolute                      0625      
 LIMITC            absolute                      0125      
 LINK              absolute                      0700      
 LOWALT            absolute                      0418      
 LOWHLT            absolute                      041C      
 MANBIT            local constant                0006      
 MANLIT            local constant                0000      
 MANUAL            absolute                      010F      
 MATH              local constant                443F      
 MAXH              absolute                      050D      
 MAXHC             absolute                      03A0      
 MAXL              absolute                      04FE      
 MAXLC             absolute                      038E      
 MEXIT             absolute                      0790      
 MPA               absolute                      076F      
 MPB               absolute                      076C      
 MPL               absolute                      0756      
 MPS               absolute                      0776      
 MPX               absolute                      0788      
 MSP3              absolute                      0779      
 MT                absolute                      0785      
 MULT              absolute                      074A      
 NEGOVF            absolute                      05F8      
 NEGWNG            absolute                      05EF      
 OKFAST            absolute                      080F      
 OKLITE            local constant                0040      
 OKSET             absolute                      0009      
 OKSLOW            absolute                      0804      
 ONES              absolute                      020D      
 OUT               absolute                      050F      
 OUTC              absolute                      03A2      
 OVERFL            absolute                      05DE      
 PFLAG             local constant                47FF      
 POSOVF            absolute                      05E9      
 PREC              absolute                      0662      
 PREHUN            local constant                4637      
 PREOK             absolute                      02CA      
 PREONE            local constant                463F      
 PRESE1            local constant                450B      
 PRESE2            local constant                4507      
 PRESE3            local constant                4503      
 PRESET            local constant                450F      
 PRETEN            local constant                463B      
 PRG               absolute                      018B      
 PRGBIT            local constant                0002      
 PRGBNK            absolute                      0192      
 PRGLIT            local constant                0020      
 PRGOK             absolute                      01B0      
 PRGPAT            absolute                      09B6      
 PULLIT            absolute                      0106      
 RAM               local constant                4000      
 RECBIT            local constant                0001      
 RECLIT            local constant                0010      
 RELCNT            local constant                437B      
 RELFLG            local constant                437D      
 RELOK             absolute                      047C      
 RESET             local constant                455F      
 RGAIN             local constant                452F      
 RTD1              absolute                      0A00      
 SCALE             absolute                      071F      
 SERVO             absolute                      062A      
 SERVOC            absolute                      012A      
 SGAIN             local constant                454F      
 SOFT              absolute                      0611      
 SOFT1             absolute                      0619      
 STACKA            absolute                      04AE      
 STACKC            absolute                      0338      
 STOP              absolute                      0628      
 STOPC             absolute                      0128      
 SUBMAN            absolute                      0604      
 SUMUP             absolute                      0282      
 TENS              absolute                      0227      
 TEST              absolute                      0B00      
 TEST0             absolute                      0B3D      
 TEST1             absolute                      0B40      
 TEST2             absolute                      0B43      
 TEST3             absolute                      0B46      
 TEST4             absolute                      0B49      
 TEST5             absolute                      0B4C      
 TEST6             absolute                      0B4F      
 TEST7             absolute                      0B52      
 TEST8             absolute                      0B55      
 TEST9             absolute                      0B58      
 TESTX             absolute                      0B5B      
 TIMER             local constant                467F      
 TLXACC            absolute                      0400      
 TLXALT            absolute                      0800      
 TLXFLY            absolute                      043C      
 TMINIT            absolute                      0013      
 TMWAIT            absolute                      0018      
 USHR              absolute                      0703      
 UTIL              local constant                44FF      
 VAL               absolute                      0029      
 VALID             absolute                      005D      
 VERSION           local constant                0005      
 VER_0             local constant                0000      
 VER_1             local constant                0001      
 VER_2             local constant                0002      
 VER_3             local constant                0003      
 VER_4             local constant                0004      
 VER_5             local constant                0005      
 WFLAG             local constant                477F      
 WHICH             absolute                      006F      
 WING              absolute                      05CA      
 WNGMAX            local constant                00CC      
 WNGNEG            local constant                0019      
 WNGPOS            local constant                00E5      
 WNGREC            local constant                00BF      
 WNGRET            local constant                007F      
 WNGRH             local constant                008B      
 WNGRL             local constant                0073      
 WNGWIN            local constant                000C      
 WNGXRI            local constant                FF34      
 WNGZER            local constant                00E5      
 ZEROC1            absolute                      040C      
 _OFFSET           absolute                      05FC      


Assembly time: 0 min, 30 sec